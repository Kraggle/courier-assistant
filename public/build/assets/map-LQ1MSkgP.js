import{c as V,g as $e,A as Ne,K as A,t as Pe}from"./K-htdgs9CQ.js";function Ue(t,e,n,i){function r(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{u(i.next(d))}catch(h){s(h)}}function l(d){try{u(i.throw(d))}catch(h){s(h)}}function u(d){d.done?o(d.value):r(d.value).then(a,l)}u((i=i.apply(t,e||[])).next())})}function Re(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var je=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(e)){if(i=e.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;r--!==0;){var s=o[r];if(!t(e[s],n[s]))return!1}return!0}return e!==e&&n!==n},Fe=Re(je);const wt="__googleMapsScriptId";var G;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(G||(G={}));class U{constructor({apiKey:e,authReferrerPolicy:n,channel:i,client:r,id:o=wt,language:s,libraries:a=[],mapIds:l,nonce:u,region:d,retries:h=3,url:b="https://maps.googleapis.com/maps/api/js",version:v}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=n,this.channel=i,this.client=r,this.id=o||wt,this.language=s,this.libraries=a,this.mapIds=l,this.nonce=u,this.region=d,this.retries=h,this.url=b,this.version=v,U.instance){if(!Fe(this.options,U.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(U.instance.options)}`);return U.instance}U.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?G.FAILURE:this.done?G.SUCCESS:this.loading?G.LOADING:G.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,n)=>{this.loadCallback(i=>{i?n(i.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,n;if(document.getElementById(this.id)){this.callback();return}const i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach(o=>!i[o]&&delete i[o]),!((n=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.maps)===null||n===void 0)&&n.importLibrary||(o=>{let s,a,l,u="The Google Maps JavaScript API",d="google",h="importLibrary",b="__ib__",v=document,x=window;x=x[d]||(x[d]={});const _=x.maps||(x.maps={}),C=new Set,g=new URLSearchParams,S=()=>s||(s=new Promise((E,m)=>Ue(this,void 0,void 0,function*(){var w;yield a=v.createElement("script"),a.id=this.id,g.set("libraries",[...C]+"");for(l in o)g.set(l.replace(/[A-Z]/g,p=>"_"+p[0].toLowerCase()),o[l]);g.set("callback",d+".maps."+b),a.src=this.url+"?"+g,_[b]=E,a.onerror=()=>s=m(Error(u+" could not load.")),a.nonce=this.nonce||((w=v.querySelector("script[nonce]"))===null||w===void 0?void 0:w.nonce)||"",v.head.append(a)})));_[h]?console.warn(u+" only loads once. Ignoring:",o):_[h]=(E,...m)=>C.add(E)&&S().then(()=>_[h](E,...m))})(i);const r=this.libraries.map(o=>this.importLibrary(o));r.length||r.push(this.importLibrary("core")),Promise.all(r).then(()=>this.callback(),o=>{const s=new ErrorEvent("error",{error:o});this.loadErrorCallback(s)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const n=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${n} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},n)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setScript())}}}function Me(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Vt=Me,De=typeof V=="object"&&V&&V.Object===Object&&V,Ge=De,He=Ge,Ke=typeof self=="object"&&self&&self.Object===Object&&self,Be=He||Ke||Function("return this")(),Zt=Be,qe=Zt,ze=function(){return qe.Date.now()},We=ze,Ye=/\s/;function Ve(t){for(var e=t.length;e--&&Ye.test(t.charAt(e)););return e}var Ze=Ve,Je=Ze,Xe=/^\s+/;function Qe(t){return t&&t.slice(0,Je(t)+1).replace(Xe,"")}var tn=Qe,en=Zt,nn=en.Symbol,Jt=nn,_t=Jt,Xt=Object.prototype,rn=Xt.hasOwnProperty,on=Xt.toString,B=_t?_t.toStringTag:void 0;function sn(t){var e=rn.call(t,B),n=t[B];try{t[B]=void 0;var i=!0}catch{}var r=on.call(t);return i&&(e?t[B]=n:delete t[B]),r}var an=sn,cn=Object.prototype,ln=cn.toString;function un(t){return ln.call(t)}var dn=un,St=Jt,hn=an,pn=dn,fn="[object Null]",gn="[object Undefined]",Tt=St?St.toStringTag:void 0;function mn(t){return t==null?t===void 0?gn:fn:Tt&&Tt in Object(t)?hn(t):pn(t)}var yn=mn;function bn(t){return t!=null&&typeof t=="object"}var vn=bn,xn=yn,Cn=vn,En="[object Symbol]";function wn(t){return typeof t=="symbol"||Cn(t)&&xn(t)==En}var _n=wn,Sn=tn,At=Vt,Tn=_n,Lt=NaN,An=/^[-+]0x[0-9a-f]+$/i,Ln=/^0b[01]+$/i,In=/^0o[0-7]+$/i,On=parseInt;function kn(t){if(typeof t=="number")return t;if(Tn(t))return Lt;if(At(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=At(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Sn(t);var n=Ln.test(t);return n||In.test(t)?On(t.slice(2),n?2:8):An.test(t)?Lt:+t}var $n=kn,Nn=Vt,ot=We,It=$n,Pn="Expected a function",Un=Math.max,Rn=Math.min;function jn(t,e,n){var i,r,o,s,a,l,u=0,d=!1,h=!1,b=!0;if(typeof t!="function")throw new TypeError(Pn);e=It(e)||0,Nn(n)&&(d=!!n.leading,h="maxWait"in n,o=h?Un(It(n.maxWait)||0,e):o,b="trailing"in n?!!n.trailing:b);function v(p){var T=i,P=r;return i=r=void 0,u=p,s=t.apply(P,T),s}function x(p){return u=p,a=setTimeout(g,e),d?v(p):s}function _(p){var T=p-l,P=p-u,W=e-T;return h?Rn(W,o-P):W}function C(p){var T=p-l,P=p-u;return l===void 0||T>=e||T<0||h&&P>=o}function g(){var p=ot();if(C(p))return S(p);a=setTimeout(g,_(p))}function S(p){return a=void 0,b&&i?v(p):(i=r=void 0,s)}function E(){a!==void 0&&clearTimeout(a),u=0,i=l=r=a=void 0}function m(){return a===void 0?s:S(ot())}function w(){var p=ot(),T=C(p);if(i=arguments,r=this,l=p,T){if(a===void 0)return x(l);if(h)return clearTimeout(a),a=setTimeout(g,e),v(l)}return a===void 0&&(a=setTimeout(g,e)),s}return w.cancel=E,w.flush=m,w}var Fn=jn;const Qt=$e(Fn),Mn="border:0px;padding:0px;",Dn="clip:rect(0px,0px,0px,0px);height:1px;margin-bottom:-1px;margin-right:-1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px",Ot=(t,e)=>(t.id=e,t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t),Gn=({document:t,idA:e,idB:n})=>{const i=t.createElement("div");i.setAttribute("style",Mn+Dn);const r=Ot(t.createElement("div"),e),o=Ot(t.createElement("div"),n);i.appendChild(r),i.appendChild(o);let s=!0;const a=Qt(l=>{const u=s?r:o,d=s?o:r;s=!s,u.textContent=l,d.textContent=""},1500,{});return{container:i,announce:a}},Hn={GBR:{iso_2:"GB",iso_3:"GBR",emoji:"ðŸ‡¬ðŸ‡§",rgeo:!0,description:"United Kingdom"},USA:{iso_2:"US",iso_3:"USA",emoji:"ðŸ‡ºðŸ‡¸",rgeo:!1,description:"United States"}},Kn=(t,e)=>{const n=[],i=Object.keys(t);for(const r of i)e.length>0&&!e.some(o=>o===r)||n.push(t[r]);return n.sort((r,o)=>r.description.localeCompare(o.description)),n},te=t=>{const e={};for(const n of t)e[n.iso_3]=n;return e},kt={tls:!0,api_key:"",baseUrl:"api.ideal-postcodes.co.uk",version:"v1",strictAuthorisation:!1,timeout:1e4,header:{Accept:"application/json","Content-Type":"application/json"},tags:[],agent:{}};let Bn=class{constructor(e){this.config={...kt,...e},this.config.header={...kt.header,...e.header&&e.header}}url(){const{baseUrl:e,version:n}=this.config;return`${this.protocol()}://${e}/${n}`}protocol(){return this.config.tls?"https":"http"}};const pt=t=>t===void 0?{}:Object.keys(t).reduce((e,n)=>{const i=t[n],r=zn(i);return r.length>0&&(e[n]=r),e},{}),$t=t=>typeof t=="string",qn=t=>Array.isArray(t),zn=t=>{const e=[];return qn(t)?(t.forEach(n=>{lt(n)&&e.push(n.toString()),$t(n)&&e.push(n)}),e.join(",")):lt(t)?t.toString():$t(t)?t:""},lt=t=>typeof t=="number",ee=({timeout:t},e)=>lt(t)?t:e.config.timeout,ne=({header:t={}},e)=>({...e.config.header,...pt(t)});let ft=class ie extends Error{constructor(e){const n=new.target.prototype;super(),this.__proto__=n;const{message:i,httpStatus:r,metadata:o={}}=e;this.message=i,this.name="Ideal Postcodes Error",this.httpStatus=r,this.metadata=o,Error.captureStackTrace&&Error.captureStackTrace(this,ie)}};class H extends ft{constructor(e){super({httpStatus:e.httpStatus,message:e.body.message}),this.response=e}}class re extends H{}class gt extends H{}class oe extends gt{}class it extends H{}class se extends it{}class ae extends it{}class K extends H{}class ce extends K{}class le extends K{}class ue extends K{}class de extends K{}class he extends H{}const Wn=200,Yn=300,Vn=400,Zn=401,Jn=4010,Xn=402,Qn=4020,ti=4021,ei=404,ni=4040,ii=4042,ri=4044,oi=4046,si=500,ai=t=>!(t<Wn||t>=Yn),ci=t=>!(t===null||typeof t!="object"),li=t=>!(!ci(t)||typeof t.message!="string"||typeof t.code!="number"),mt=t=>{const{httpStatus:e,body:n}=t;if(!ai(e)){if(li(n)){const{code:i}=n;if(i===Jn)return new oe(t);if(i===ni)return new ce(t);if(i===ii)return new le(t);if(i===ri)return new ue(t);if(i===oi)return new de(t);if(i===Qn)return new se(t);if(i===ti)return new ae(t);if(e===ei)return new K(t);if(e===Vn)return new re(t);if(e===Xn)return new it(t);if(e===Zn)return new gt(t);if(e===si)return new he(t)}return new ft({httpStatus:e,message:JSON.stringify(n)})}},ui=Object.freeze(Object.defineProperty({__proto__:null,IdealPostcodesError:ft,IdpcApiError:H,IdpcBadRequestError:re,IdpcBalanceDepletedError:se,IdpcInvalidKeyError:oe,IdpcKeyNotFoundError:le,IdpcLimitReachedError:ae,IdpcPostcodeNotFoundError:ce,IdpcRequestFailedError:it,IdpcResourceNotFoundError:K,IdpcServerError:he,IdpcUdprnNotFoundError:ue,IdpcUmprnNotFoundError:de,IdpcUnauthorisedError:gt,parse:mt},Symbol.toStringTag,{value:"Module"})),di=(t,e)=>[t.client.url(),t.resource,encodeURIComponent(e),t.action].filter(n=>n!==void 0).join("/"),yt=t=>{const{client:e}=t;return(n,i)=>e.config.agent.http({method:"GET",url:di(t,n),query:pt(i.query),header:ne(i,e),timeout:ee(i,e)}).then(r=>{const o=mt(r);if(o)throw o;return r})},hi=t=>{const{client:e,resource:n}=t;return i=>e.config.agent.http({method:"GET",url:`${e.url()}/${n}`,query:pt(i.query),header:ne(i,e),timeout:ee(i,e)}).then(r=>{const o=mt(r);if(o)throw o;return r})},pi="keys",fi=(t,e,n)=>yt({resource:pi,client:t})(e,n),pe=t=>{const{client:e,timeout:n}=t,i=t.api_key||t.client.config.api_key,{licensee:r}=t;let o;r===void 0?o={}:o={licensee:r};const s={query:o,header:{}};return n!==void 0&&(s.timeout=n),fi(e,i,s).then(a=>a.body.result)},bt="autocomplete/addresses",gi=(t,e)=>hi({resource:bt,client:t})(e),mi=(t,e,n)=>yt({resource:bt,client:t,action:"usa"})(e,n),yi=(t,e,n)=>yt({resource:bt,client:t,action:"gbr"})(e,n),{IdealPostcodesError:bi}=ui,vi=t=>Object.keys(t).reduce((e,n)=>{const i=t[n];return typeof i=="string"?e[n]=i:Array.isArray(i)&&(e[n]=i.join(",")),e},{}),Nt=(t,e)=>({httpRequest:t,body:e.data,httpStatus:e.status||0,header:vi(e.headers),metadata:{response:e}}),Pt=t=>{const e=new bi({message:`[${t.name}] ${t.message}`,httpStatus:0,metadata:{axios:t}});return Promise.reject(e)},xi=()=>!0;class Ci{constructor(){this.Axios=Ne.create({validateStatus:xi})}requestWithBody(e){const{body:n,method:i,timeout:r,url:o,header:s,query:a}=e;return this.Axios.request({url:o,method:i,headers:s,params:a,data:n,timeout:r}).then(l=>Nt(e,l)).catch(Pt)}request(e){const{method:n,timeout:i,url:r,header:o,query:s}=e;return this.Axios.request({url:r,method:n,headers:o,params:s,timeout:i}).then(a=>Nt(e,a)).catch(Pt)}http(e){return e.body!==void 0?this.requestWithBody(e):this.request(e)}}class fe extends Bn{constructor(e){const n=new Ci;super({agent:n,...e})}}class Ei{constructor(e){this.prefix="!",this.client=e,this.cache={}}key(e){return`${this.prefix}${e.toLowerCase()}`}retrieve(e){return this.cache[this.key(e)]}store(e,n){return this.cache[this.key(e)]=n,n}clear(){this.cache={}}query(e,n={}){const i=this.retrieve(e);if(i)return Promise.resolve(i);const r=gi(this.client,{query:{query:e,api_key:this.client.config.api_key,...n}}).then(o=>{const s=o.body.result.hits;return this.store(e,s),s});return this.store(e,r),r}resolve(e,n){return n==="usa"?this.usaResolve(e):this.gbrResolve(e)}usaResolve(e){return mi(this.client,e.id,{query:{api_key:this.client.config.api_key}}).then(n=>n.body.result)}gbrResolve(e){return yi(this.client,e.id,{query:{api_key:this.client.config.api_key}}).then(n=>n.body.result)}}const j=t=>typeof t=="string",wi=()=>typeof window<"u",_i=t=>Array.prototype.slice.call(t),Si=(t,e="idpc")=>t.getAttribute(e)==="true",Ti=(t,e="idpc")=>t.setAttribute(e,"true"),Ai=()=>!0,Li=(t,e,n=Ai)=>{let i=t;const r=e.toUpperCase();for(;i.tagName!=="HTML";){if(i.tagName===r&&n(i))return i;if(i.parentNode===null)return null;i=i.parentNode}return null},Ii=(t,e)=>e?t.querySelector(e):null,L=(t,e)=>j(t)?e.querySelector(t):t,ut=()=>window.document,ge=t=>j(t)?ut().querySelector(t):t===null?ut():t,Oi=t=>t instanceof Document||t.constructor.name==="HTMLDocument"?t:t.ownerDocument?t.ownerDocument:ut(),M=(t,e)=>{const n=t.getAttribute("style");return Object.keys(e).forEach(i=>t.style[i]=e[i]),n},ki=(t,e)=>{t.setAttribute("style",e||"")},Z=t=>(t.style.display="none",t),Ut=t=>(t.style.display="",t),$i=t=>{t===null||t.parentNode===null||t.parentNode.removeChild(t)},Ni=(t,e,n)=>{const i=t.querySelectorAll(e);for(let r=0;r<i.length;r++){const o=i[r],s=o.innerText;if(s&&s.trim()===n)return o}return null},Pi=({pageTest:t,bind:e,interval:n=1e3})=>{let i=null;const r=s=>t()?(i=window.setInterval(()=>{try{e(s)}catch(a){o(),console.log(a)}},n),i):null,o=()=>{i!==null&&(window.clearInterval(i),i=null)};return{start:r,stop:o}},Ui=t=>{t=String(t);const e=t.length;let n=-1,i,r="";const o=t.charCodeAt(0);for(;++n<e;){if(i=t.charCodeAt(n),i==0){r+="ï¿½";continue}if(i>=1&&i<=31||i==127||n==0&&i>=48&&i<=57||n==1&&i>=48&&i<=57&&o==45){r+="\\"+i.toString(16)+" ";continue}if(n==0&&e==1&&i==45){r+="\\"+t.charAt(n);continue}if(i>=128||i==45||i==95||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122){r+=t.charAt(n);continue}r+="\\"+t.charAt(n)}return r},me=t=>t.post_town!==void 0,Ri=(t,e)=>{const n=e.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=t,n},ji=(t,e)=>{const n=e.createElement("style");return n.type="text/css",n.appendChild(e.createTextNode(t)),e.head.appendChild(n),n},Fi=({event:t,bubbles:e=!0,cancelable:n=!0})=>{if(typeof window.Event=="function")return new window.Event(t,{bubbles:e,cancelable:n});const i=document.createEvent("Event");return i.initEvent(t,e,n),i},Q=(t,e)=>t.dispatchEvent(Fi({event:e})),tt=t=>t===null?!1:t instanceof HTMLSelectElement||t.constructor.name==="HTMLSelectElement",z=t=>t===null?!1:t instanceof HTMLInputElement||t.constructor.name==="HTMLInputElement",ye=t=>t===null?!1:t instanceof HTMLTextAreaElement||t.constructor.name==="HTMLTextAreaElement",O=(t,e,n=!1)=>{t&&(!z(t)&&!ye(t)||R({e:t,value:e,skipTrigger:n}))},q=(t,e)=>e===null?!1:t.querySelector(`[value="${e}"]`)!==null,Mi=({e:t,value:e,skipTrigger:n})=>{e!==null&&tt(t)&&(be(t,e),n||Q(t,"select"),Q(t,"change"))},be=(t,e)=>{const n=Object.getOwnPropertyDescriptor(t.constructor.prototype,"value");if(n===void 0||n.set===void 0)return;n.set.call(t,e)},Di=({e:t,value:e,skipTrigger:n})=>{e!==null&&(!z(t)&&!ye(t)||(be(t,e),n||Q(t,"input"),Q(t,"change")))},R=t=>{t.value!==null&&(Mi(t),Di(t))},J="United Kingdom",Rt="Isle of Man",Gi="England",Hi="Scotland",Ki="Wales",Bi="Northern Ireland",qi="Channel Islands",jt=t=>{const e=t.country;if(e===Gi||e===Hi||e===Ki||e===Bi)return J;if(e===Rt)return Rt;if(me(t)&&e===qi){if(/^GY/.test(t.postcode))return"Guernsey";if(/^JE/.test(t.postcode))return"Jersey"}return e},zi=(t,e)=>{if(t){if(tt(t)){const n=jt(e);q(t,n)&&R({e:t,value:n}),q(t,e.country_iso_2)&&R({e:t,value:e.country_iso_2}),q(t,e.country_iso)&&R({e:t,value:e.country_iso})}if(z(t)){const n=jt(e);R({e:t,value:n})}}};let dt={};wi()&&(window.idpcGlobal?dt=window.idpcGlobal:window.idpcGlobal=dt);const ve=()=>dt,Wi=(t="idpc_")=>()=>{const e=ve();return e.idGen||(e.idGen={}),e.idGen[t]===void 0&&(e.idGen[t]=0),e.idGen[t]+=1,`${t}${e.idGen[t]}`};var vt={};Object.defineProperty(vt,"__esModule",{value:!0});var xe=vt.capitalisePostTown=void 0,Yi=/^(of|le|upon|on|the)$/,Vi=/\w+&\w+/,Ce=function(t){return t=t.toLowerCase(),t.match(Yi)?t:t.match(Vi)?t.toUpperCase():t.charAt(0).toUpperCase()+t.slice(1)},Zi=/-/,Ji=/^(in|de|under|upon|y|on|over|the|by)$/,Xi=function(t){return t.match(Zi)===null?t:t.split("-").map(function(e){return e.match(Ji)?e.toLowerCase():Ce(e)}).join("-")},Qi=/bo'ness/i,tr=/bfpo/i,er=function(t){return t.match(Qi)?"Bo'Ness":t.match(tr)?"BFPO":t},nr=function(t){return t.split(" ").map(Ce).map(Xi).map(er).join(" ")};xe=vt.capitalisePostTown=nr;const ir=t=>{const{line_2:e,line_3:n}=t;return e?n?3:2:1},et=t=>t.filter(e=>j(e)?!!e.trim():!!e).join(", "),st=(t,e)=>{if(t.length<=e)return[t,""];const n=t.split(" ");let i="",r="";for(let o=0;o<n.length;o++){const s=n[o];if(i.length+s.length>e){r=n.slice(o).join(" ");break}i+=`${s} `}return[i.trim(),r.trim()]},at=(t,e)=>e.length===0?t:`${t}, ${e}`,rr=(t,e)=>{const{lineCount:n,maxLineOne:i,maxLineTwo:r,maxLineThree:o}=e,s=["","",""],a=[...t];if(i){const[l,u]=st(a[0],i);if(s[0]=l,u&&(a[1]=at(u,a[1])),n===1)return s}else if(s[0]=a[0],n===1)return[et(a),"",""];if(r){const[l,u]=st(a[1],r);if(s[1]=l,u&&(a[2]=at(u,a[2])),n===2)return s}else if(s[1]=a[1],n===2)return[s[0],et(a.slice(1)),""];if(o){const[l,u]=st(a[2],o);s[2]=l,u&&(a[3]=at(u,a[3]))}else s[2]=a[2];return s},or=(t,e,n)=>{const{line_1:i,line_2:r}=e,o="line_3"in e?e.line_3:"";return n.maxLineOne||n.maxLineTwo||n.maxLineThree?rr([i,r,o],{lineCount:t,...n}):t===3?[i,r,o]:t===2?[i,et([r,o]),""]:[et([i,r,o]),"",""]},sr=(t,e)=>{const n=t[e];return typeof n=="number"?n.toString():n===void 0?"":n},ar=t=>({...t.outputFields,...lr(t.names||{},t.config.scope),...ur(t.labels||{},t.config.scope)}),cr=(t,e,n,i)=>{const[r,o,s]=or(ir(t),e,i);O(L(t.line_1||null,n),r),O(L(t.line_2||null,n),o),O(L(t.line_3||null,n),s)},lr=(t,e)=>{const n={};let i;for(i in t){if(!t.hasOwnProperty(i))continue;const r=t[i],o=L(`[name="${r}"]`,e);if(o){n[i]=o;continue}const s=L(`[aria-name="${r}"]`,e);s&&(n[i]=s)}return n},ur=(t,e)=>{const n={};if(t===void 0)return t;let i;for(i in t){if(!t.hasOwnProperty(i))continue;const r=t[i];if(!r)continue;const o=Ni(e,"label",r),s=L(o,e);if(!s)continue;const a=s.getAttribute("for");if(a){const u=e.querySelector(`#${Ui(a)}`);if(u){n[i]=u;continue}}const l=s.querySelector("input");l&&(n[i]=l)}return n},dr=t=>{const{config:e}=t,n={...t.address},{scope:i,titleizePostTown:r,populateOrganisation:o,populateCounty:s}=e,a=ar(t);me(n)&&(e.removeOrganisation&&hr(n),"post_town"in n&&r&&(n.post_town=xe(n.post_town)),o===!1&&delete n.organisation_name,s===!1&&delete n.county),cr(a,n,i,e),delete n.line_1,delete n.line_2,delete n.line_3,zi(L(a.country||null,i),n),delete n.country;const l=L(a.country_iso_2||null,i);tt(l)&&q(l,n.country_iso_2)&&R({e:l,value:n.country_iso_2}),z(l)&&O(l,n.country_iso_2||""),delete n.country_iso_2;const u=L(a.country_iso||null,i);tt(u)&&q(u,n.country_iso)&&R({e:u,value:n.country_iso_2}),z(u)&&O(u,n.country_iso||""),delete n.country_iso;let d;for(d in a)if(n[d]!==void 0&&a.hasOwnProperty(d)){const h=a[d];if(!h)continue;O(L(h,i),sr(n,d))}},hr=t=>(t.organisation_name.length===0||t.line_2.length===0&&t.line_3.length===0||t.line_1===t.organisation_name&&(t.line_1=t.line_2,t.line_2=t.line_3,t.line_3=""),t),pr={13:"Enter",38:"ArrowUp",40:"ArrowDown",36:"Home",35:"End",27:"Escape",8:"Backspace"},fr=["Enter","ArrowUp","ArrowDown","Home","End","Escape","Backspace"],gr=t=>fr.indexOf(t)!==-1,mr=t=>t.keyCode?pr[t.keyCode]||null:gr(t.key)?t.key:null,yr=".idpc_af.hidden{display:none}div.idpc_autocomplete{position:relative;margin:0!important;padding:0;border:0;color:#28282b;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}div.idpc_autocomplete>input{display:block}div.idpc_af{position:absolute;left:0;z-index:2000;min-width:100%;box-sizing:border-box;border-radius:3px;background:#fff;border:1px solid rgba(0,0,0,.3);box-shadow:.05em .2em .6em rgba(0,0,0,.2);text-shadow:none;padding:0;margin-top:2px}div.idpc_af>ul{list-style:none;padding:0;max-height:250px;overflow-y:scroll;margin:0!important}div.idpc_af>ul>li{position:relative;padding:.2em .5em;cursor:pointer;margin:0!important}div.idpc_toolbar{padding:.3em .5em;border-top:1px solid rgba(0,0,0,.3);text-align:right}div.idpc_af>ul>li:hover{background-color:#e5e4e2}div.idpc_af>ul>li.idpc_error{padding:.5em;text-align:center;cursor:default!important}div.idpc_af>ul>li.idpc_error:hover{background:#fff;cursor:default!important}div.idpc_af>ul>li[aria-selected=true]{background-color:#e5e4e2;z-index:3000}div.idpc_autocomplete>.idpc-unhide{font-size:.9em;text-decoration:underline;cursor:pointer}div.idpc_af>div>span{padding:.2em .5em;border-radius:3px;cursor:pointer;font-size:110%}span.idpc_icon{font-size:1.2em;line-height:1em;vertical-align:middle}div.idpc_toolbar>span span.idpc_country{margin-right:.3em;max-width:0;font-size:.9em;-webkit-transition:max-width .5s ease-out;transition:max-width .5s ease-out;display:inline-block;vertical-align:middle;white-space:nowrap;overflow:hidden}div.idpc_autocomplete>div>div>span:hover span.idpc_country{max-width:7em}div.idpc_autocomplete>div>div>span:hover{background-color:#e5e4e2;-webkit-transition:background-color .5s ease;-ms-transition:background-color .5s ease;transition:background-color .5s ease}",br=t=>{const e=t.options.injectStyle;if(!e)return;const n=ve();if(n.afstyle||(n.afstyle={}),j(e)&&!n.afstyle[e]){n.afstyle[e]=!0;const i=Ri(e,t.document);return t.document.head.appendChild(i),i}if(e===!0&&!n.afstyle[""])return n.afstyle[""]=!0,ji(yr,t.document)},vr=t=>{let e;const n=t.input;if(t.options.alignToInput===!1)return{};try{const o=t.options.document.defaultView;if(!o)return{};e=o.getComputedStyle(n).marginBottom}catch{return{}}if(!e)return{};const i=parseInt(e.replace("px",""),10);return isNaN(i)?{}:i===0?{}:{marginTop:i*-1+t.options.offset+"px"}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ct(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),s=[];try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}var N;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(N||(N={}));var Ee={type:"xstate.init"};function X(t){return t===void 0?[]:[].concat(t)}function Ft(t,e){return typeof(t=typeof t=="string"&&e&&e[t]?e[t]:t)=="string"?{type:t}:typeof t=="function"?{type:t.name,exec:t}:t}function nt(t){return function(e){return t===e}}function we(t){return typeof t=="string"?{type:t}:t}function Mt(t,e){return{value:t,context:e,actions:[],changed:!1,matches:nt(t)}}function Dt(t,e,n){var i=e,r=!1;return[t.filter(function(o){if(o.type==="xstate.assign"){r=!0;var s=Object.assign({},i);return typeof o.assignment=="function"?s=o.assignment(i,n):Object.keys(o.assignment).forEach(function(a){s[a]=typeof o.assignment[a]=="function"?o.assignment[a](i,n):o.assignment[a]}),i=s,!1}return!0}),i,r]}function xr(t,e){e===void 0&&(e={});var n=ct(Dt(X(t.states[t.initial].entry).map(function(s){return Ft(s,e.actions)}),t.context,Ee),2),i=n[0],r=n[1],o={config:t,_options:e,initialState:{value:t.initial,actions:i,context:r,matches:nt(t.initial)},transition:function(s,a){var l,u,d=typeof s=="string"?{value:s,context:t.context}:s,h=d.value,b=d.context,v=we(a),x=t.states[h];if(x.on){var _=X(x.on[v.type]);"*"in x.on&&_.push.apply(_,function(y,I,Y){if(Y||arguments.length===2)for(var k,F=0,ke=I.length;F<ke;F++)!k&&F in I||(k||(k=Array.prototype.slice.call(I,0,F)),k[F]=I[F]);return y.concat(k||Array.prototype.slice.call(I))}([],ct(X(x.on["*"])),!1));try{for(var C=function(y){var I=typeof Symbol=="function"&&Symbol.iterator,Y=I&&y[I],k=0;if(Y)return Y.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&k>=y.length&&(y=void 0),{value:y&&y[k++],done:!y}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}(_),g=C.next();!g.done;g=C.next()){var S=g.value;if(S===void 0)return Mt(h,b);var E=typeof S=="string"?{target:S}:S,m=E.target,w=E.actions,p=w===void 0?[]:w,T=E.cond,P=T===void 0?function(){return!0}:T,W=m===void 0,Ae=m??h,Le=t.states[Ae];if(P(b,v)){var rt=ct(Dt((W?X(p):[].concat(x.exit,p,Le.entry).filter(function(y){return y})).map(function(y){return Ft(y,o._options.actions)}),b,v),3),Ct=rt[0],Ie=rt[1],Oe=rt[2],Et=m??h;return{value:Et,context:Ie,actions:Ct,changed:m!==h||Ct.length>0||Oe,matches:nt(Et)}}}}catch(y){l={error:y}}finally{try{g&&!g.done&&(u=C.return)&&u.call(C)}finally{if(l)throw l.error}}}return Mt(h,b)}};return o}var Gt=function(t,e){return t.actions.forEach(function(n){var i=n.exec;return i&&i(t.context,e)})};function Cr(t){var e=t.initialState,n=N.NotStarted,i=new Set,r={_machine:t,send:function(o){n===N.Running&&(e=t.transition(e,o),Gt(e,we(o)),i.forEach(function(s){return s(e)}))},subscribe:function(o){return i.add(o),o(e),{unsubscribe:function(){return i.delete(o)}}},start:function(o){if(o){var s=typeof o=="object"?o:{context:t.config.context,value:o};e={value:s.value,actions:[],context:s.context,matches:nt(s.value)}}else e=t.initialState;return n=N.Running,Gt(e,Ee),r},stop:function(){return n=N.Stopped,i.clear(),r},get state(){return e},get status(){return n}};return r}const Er=({c:t})=>{const e=xr({initial:"closed",states:{closed:{entry:["close"],exit:["open"],on:{COUNTRY_CHANGE_EVENT:{actions:["updateContextWithCountry"]},AWAKE:[{target:"suggesting",cond:()=>t.suggestions.length>0},{target:"notifying"}]}},notifying:{entry:["renderNotice"],exit:["clearAnnouncement"],on:{CLOSE:"closed",SUGGEST:{target:"suggesting",actions:["updateSuggestions"]},NOTIFY:{target:"notifying",actions:["updateMessage"]},INPUT:{actions:"input"},CHANGE_COUNTRY:{target:"suggesting_country"}}},suggesting_country:{entry:["clearInput","renderContexts","gotoCurrent","expand","addCountryHint"],exit:["resetCurrent","gotoCurrent","contract","clearHint","clearInput"],on:{CLOSE:"closed",NOTIFY:{target:"notifying",actions:["updateMessage"]},NEXT:{actions:["next","gotoCurrent"]},PREVIOUS:{actions:["previous","gotoCurrent"]},RESET:{actions:["resetCurrent","gotoCurrent"]},INPUT:{actions:["countryInput"]},SELECT_COUNTRY:{target:"notifying",actions:["selectCountry"]}}},suggesting:{entry:["renderSuggestions","gotoCurrent","expand","addHint"],exit:["resetCurrent","gotoCurrent","contract","clearHint"],on:{CLOSE:"closed",SUGGEST:{target:"suggesting",actions:["updateSuggestions"]},NOTIFY:{target:"notifying",actions:["updateMessage"]},INPUT:{actions:"input"},CHANGE_COUNTRY:{target:"suggesting_country"},NEXT:{actions:["next","gotoCurrent"]},PREVIOUS:{actions:["previous","gotoCurrent"]},RESET:{actions:["resetCurrent","gotoCurrent"]},SELECT_ADDRESS:{target:"closed",actions:["selectAddress"]}}}}},{actions:{updateContextWithCountry:(n,i)=>{i.type==="COUNTRY_CHANGE_EVENT"&&i.contextDetails&&(t.applyContext(i.contextDetails),t.suggestions=[],t.cache.clear())},addHint:()=>{t.setPlaceholder(t.options.msgPlaceholder)},addCountryHint:()=>{t.setPlaceholder(t.options.msgPlaceholderCountry)},clearHint:()=>{t.unsetPlaceholder()},clearInput:()=>{t.clearInput()},gotoCurrent:()=>{t.goToCurrent()},resetCurrent:()=>{t.current=-1},input:(n,i)=>{i.type==="INPUT"&&t.retrieveSuggestions(i.event)},countryInput:()=>{t.renderContexts()},clearAnnouncement:()=>{t.announce("")},renderContexts:(n,i)=>{i.type==="CHANGE_COUNTRY"&&t.renderContexts()},renderSuggestions:(n,i)=>{i.type==="SUGGEST"&&t.renderSuggestions()},updateSuggestions:(n,i)=>{i.type==="SUGGEST"&&t.updateSuggestions(i.suggestions)},close:(n,i)=>{if(i.type==="CLOSE")return t.close(i.reason);t.close()},open:()=>{t.open()},expand:()=>{t.ariaExpand()},contract:()=>{t.ariaContract()},updateMessage:(n,i)=>{i.type==="NOTIFY"&&(t.notification=i.notification)},renderNotice:()=>{t.renderNotice()},next:()=>{t.next()},previous:()=>{t.previous()},selectCountry:(n,i)=>{if(i.type!=="SELECT_COUNTRY")return;const r=i.contextDetails;r&&(t.applyContext(r),t.notification=`Country switched to ${r.description} ${r.emoji}`)},selectAddress:(n,i)=>{if(i.type!=="SELECT_ADDRESS")return;const r=i.suggestion;r&&t.applySuggestion(r)}}});return Cr(e)},f=()=>{},ht={outputScope:null,apiKey:"",checkKey:!0,aria:"1.0",titleizePostTown:!0,format:"gbr",outputFields:{},names:{},labels:{},removeOrganisation:!1,injectStyle:!0,inputField:"",autocomplete:"none",populateCounty:!0,populateOrganisation:!0,queryOptions:{},alignToInput:!0,offset:2,hideToolbar:!1,detectCountry:!0,defaultCountry:"GBR",restrictCountries:[],contexts:Hn,msgFallback:"Please enter your address manually",msgInitial:"Start typing to find address",msgNoMatch:"No matches found",msgList:"Select your address",msgCountryToggle:"Change Country",msgPlaceholder:"Type the first line or postal code of your address",msgPlaceholderCountry:"Select your country",messageClass:"idpc_error",containerClass:"idpc_autocomplete",mainClass:"idpc_af",listClass:"idpc_ul",toolbarClass:"idpc_toolbar",countryToggleClass:"idpc_country",mainStyle:{},inputStyle:{},listStyle:{},liStyle:{},containerStyle:{},unhide:null,unhideClass:"idpc-unhide",msgUnhide:"Enter address manually",hide:[],fixed:!1,onOpen:f,onSelect:f,onBlur:f,onClose:f,onFocus:f,onInput:f,onLoaded:f,onSearchError:f,onSuggestionError:f,onMounted:f,onRemove:f,onSuggestionsRetrieved:f,onAddressSelected:f,onAddressRetrieved:f,onAddressPopulated:f,onFailedCheck:f,onMouseDown:f,onKeyDown:f,onUnhide:f,onCountrySelected:f,onContextChange:f};class _e{constructor(e){this.options={scope:window.document,document:window.document,...ht,...e},e.inputField||(this.options.inputField=this.options.outputFields.line_1||""),this.options.autocomplete===!0&&(this.options.autocomplete=ht.autocomplete),this.scope=ge(this.options.scope),this.document=Oi(this.scope),this.outputScope=Ht(this.scope,this.options.outputScope,()=>this.scope),this.context=this.options.defaultCountry,this.notification=this.options.msgInitial,this.current=-1,this.suggestions=[],this.contextSuggestions=[],this.updateContexts(this.options.contexts),this.client=new fe({...this.options,api_key:this.options.apiKey}),this.cache=new Ei(this.client),this.retrieveSuggestions=Qt(a=>{this.options.onInput.call(this,a);const l=this.query();return l.trim().length===0?(this.setMessage(this.options.msgInitial),Promise.resolve(this)):this.cache.query(l,{...this.options.queryOptions,context:this.context}).then(u=>(this.options.onSuggestionsRetrieved.call(this,u),this.setSuggestions(u,l))).catch(u=>(this.query()===l&&this.setMessage(this.options.msgFallback),this.options.onSuggestionError.call(this,u),this))},100,{leading:!0,trailing:!0,maxWait:100}),this.ids=Wi("idpcaf"),this.container=this.options.document.createElement("div"),this.container.className=this.options.containerClass,this.container.id=this.ids(),this.container.setAttribute("aria-haspopup","listbox"),this.message=this.options.document.createElement("li"),this.message.textContent=this.options.msgInitial,this.message.className=this.options.messageClass,this.countryToggle=this.options.document.createElement("span"),this.countryToggle.className=this.options.countryToggleClass,this.countryToggle.addEventListener("mousedown",Tr(this)),this.countryIcon=this.options.document.createElement("span"),this.countryIcon.className="idpc_icon",this.countryIcon.innerText=this.currentContext().emoji,this.countryMessage=this.options.document.createElement("span"),this.countryMessage.innerText="Select Country",this.countryMessage.className="idpc_country",this.countryToggle.appendChild(this.countryMessage),this.countryToggle.appendChild(this.countryIcon),this.toolbar=this.options.document.createElement("div"),this.toolbar.className=this.options.toolbarClass,this.toolbar.appendChild(this.countryToggle),this.options.hideToolbar&&Z(this.toolbar),this.list=this.options.document.createElement("ul"),this.list.className=this.options.listClass,this.list.id=this.ids(),this.list.setAttribute("aria-label",this.options.msgList),this.list.setAttribute("role","listbox"),this.mainComponent=this.options.document.createElement("div"),this.mainComponent.appendChild(this.list),this.mainComponent.appendChild(this.toolbar),this.mainComponent.className=this.options.mainClass,Z(this.mainComponent),this.unhideEvent=this.unhideFields.bind(this),this.unhide=this.createUnhide();let n;if(j(this.options.inputField)?n=this.scope.querySelector(this.options.inputField):n=this.options.inputField,!n)throw new Error("Address Finder: Unable to find valid input field");this.input=n,this.input.setAttribute("autocomplete",this.options.autocomplete),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-controls",this.list.id),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-activedescendant",""),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("spellcheck","false"),this.input.id||(this.input.id=this.ids());const i=this.scope.querySelector(this.options.outputFields.country);this.countryInput=i,this.ariaAnchor().setAttribute("role","combobox"),this.ariaAnchor().setAttribute("aria-expanded","false"),this.ariaAnchor().setAttribute("aria-owns",this.list.id),this.placeholderCache=this.input.placeholder,this.inputListener=Sr(this),this.blurListener=wr(this),this.focusListener=_r(this),this.keydownListener=Ar(this),this.countryListener=Lr(this);const{container:r,announce:o}=Gn({idA:this.ids(),idB:this.ids(),document:this.options.document});this.announce=o,this.alerts=r,this.inputStyle=M(this.input,this.options.inputStyle),M(this.container,this.options.containerStyle),M(this.list,this.options.listStyle);const s=vr(this);M(this.mainComponent,{...s,...this.options.mainStyle}),this.fsm=Er({c:this}),this.init()}setPlaceholder(e){this.input.placeholder=e}unsetPlaceholder(){if(this.placeholderCache===void 0)return this.input.removeAttribute("placeholder");this.input.placeholder=this.placeholderCache}currentContext(){const e=this.options.contexts[this.context];if(e)return e;const n=Object.keys(this.options.contexts)[0];return this.options.contexts[n]}load(){this.attach(),br(this),this.options.fixed&&Ir(this.mainComponent,this.container,this.document),this.options.onLoaded.call(this)}init(){return new Promise(e=>{if(!this.options.checkKey){this.load(),e();return}pe({client:this.client,api_key:this.options.apiKey}).then(n=>{if(!n.available)throw new Error("Key currently not usable");this.updateContexts(te(n.contexts));const i=this.options.contexts[n.context];this.options.detectCountry&&i?this.applyContext(i,!1):this.applyContext(this.currentContext(),!1),this.load(),e()}).catch(n=>{this.options.onFailedCheck.call(this,n),e()})})}updateContexts(e){this.contextSuggestions=Kn(e,this.options.restrictCountries),this.options.contexts=e}filteredContexts(){const e=this.query();if(e.trim().length===0)return this.contextSuggestions;const n=e.toLowerCase().trim().replace(/\s+/g," "),i=new RegExp("^"+n);return this.contextSuggestions.filter(r=>!!(i.test(r.description.toLowerCase())||r.iso_2.toLowerCase()===n||r.iso_3.toLowerCase()===n))}renderContexts(){this.list.innerHTML="",this.filteredContexts().forEach((e,n)=>{const{description:i}=e,r=this.options.document.createElement("li");r.textContent=i,r.setAttribute("aria-selected","false"),r.setAttribute("tabindex","-1"),r.setAttribute("aria-posinset",`${n+1}`),r.setAttribute("aria-setsize",this.contextSuggestions.length.toString()),r.setAttribute("role","option"),M(r,this.options.liStyle),r.addEventListener("mousedown",o=>{o.preventDefault(),this.options.onMouseDown.call(this,o),this.fsm.send({type:"SELECT_COUNTRY",contextDetails:e})}),r.id=`${this.list.id}_${n}`,this.list.appendChild(r)}),this.announce(`${this.contextSuggestions.length} countries available`)}renderSuggestions(){this.list.innerHTML="";const e=this.suggestions;e.forEach((n,i)=>{const r=this.options.document.createElement("li");r.textContent=n.suggestion,r.setAttribute("aria-selected","false"),r.setAttribute("tabindex","-1"),r.setAttribute("title",n.suggestion),r.setAttribute("aria-posinset",`${i+1}`),r.setAttribute("aria-setsize",e.length.toString()),r.setAttribute("role","option"),M(r,this.options.liStyle),r.addEventListener("mousedown",o=>{o.preventDefault(),this.options.onMouseDown.call(this,o),this.fsm.send({type:"SELECT_ADDRESS",suggestion:n})}),r.id=`${this.list.id}_${i}`,this.list.appendChild(r)}),this.announce(`${e.length} addresses available`)}goToCurrent(){const e=this.list.children;this.input.setAttribute("aria-activedescendant","");for(let n=0;n<e.length;n+=1)n===this.current?(this.input.setAttribute("aria-activedescendant",e[n].id),e[n].setAttribute("aria-selected","true"),this.goto(n)):e[n].setAttribute("aria-selected","false")}ariaExpand(){this.ariaAnchor().setAttribute("aria-expanded","true")}ariaContract(){this.ariaAnchor().setAttribute("aria-expanded","false")}applySuggestion(e){return this.options.onSelect.call(this,e),this.options.onAddressSelected.call(this,e),this.announce(`The address ${e.suggestion} has been applied to this form`),this.cache.resolve(e,this.options.format).then(n=>{if(n===null)throw"Unable to retrieve address";return this.options.onAddressRetrieved.call(this,n),this.populateAddress(n),this}).catch(n=>(this.open(),this.setMessage(this.options.msgFallback),this.options.onSearchError.call(this,n),n))}populateAddress(e){this.unhideFields(),dr({address:e,config:{...this.options,scope:this.outputScope},outputFields:this.options.outputFields,names:this.options.names,labels:this.options.labels}),this.options.onAddressPopulated.call(this,e)}setQueryOptions(e){this.cache.clear(),this.options.queryOptions=e}attach(){if(this.fsm.status===N.Running)return this;this.input.addEventListener("input",this.inputListener),this.input.addEventListener("blur",this.blurListener),this.input.addEventListener("focus",this.focusListener),this.input.addEventListener("keydown",this.keydownListener),this.input.addEventListener("keydown",this.keydownListener),this.countryInput&&this.countryInput.addEventListener("change",this.countryListener);const e=this.input.parentNode;return e&&(e.insertBefore(this.container,this.input),this.container.appendChild(this.input),this.container.appendChild(this.mainComponent),this.container.appendChild(this.alerts),this.options.hide.length>0&&this.options.unhide==null&&this.container.appendChild(this.unhide)),this.fsm.start(),this.options.onMounted.call(this),this.hideFields(),this}detach(){if(this.fsm.status!==N.Running)return this;this.input.removeEventListener("input",this.inputListener),this.input.removeEventListener("blur",this.blurListener),this.input.removeEventListener("focus",this.focusListener),this.input.removeEventListener("keydown",this.keydownListener),this.countryInput&&this.countryInput.removeEventListener("change",this.countryListener),this.container.removeChild(this.mainComponent),this.container.removeChild(this.alerts);const e=this.container.parentNode;return e&&(e.insertBefore(this.input,this.container),e.removeChild(this.container)),this.unmountUnhide(),this.unhideFields(),this.fsm.stop(),ki(this.input,this.inputStyle),this.options.onRemove.call(this),this.unsetPlaceholder(),this}setMessage(e){return this.fsm.send({type:"NOTIFY",notification:e}),this}ariaAnchor(){return this.options.aria==="1.0"?this.input:this.container}query(){return this.input.value}clearInput(){O(this.input,"")}setSuggestions(e,n){return n!==this.query()?this:e.length===0?this.setMessage(this.options.msgNoMatch):(this.fsm.send({type:"SUGGEST",suggestions:e}),this)}close(e="blur"){Z(this.mainComponent),e==="esc"&&O(this.input,""),this.options.onClose.call(this,e)}updateSuggestions(e){this.suggestions=e,this.current=-1}applyContext(e,n=!0){const i=e.iso_3;this.context=i,this.cache.clear(),this.countryIcon.innerText=e.emoji,n&&this.announce(`Country switched to ${e.description}`),this.options.onContextChange.call(this,i)}renderNotice(){this.list.innerHTML="",this.input.setAttribute("aria-activedescendant",""),this.message.textContent=this.notification,this.announce(this.notification),this.list.appendChild(this.message)}open(){Ut(this.mainComponent),this.options.onOpen.call(this)}next(){return this.current+1>this.list.children.length-1?this.current=0:this.current+=1,this}previous(){return this.current-1<0?this.current=this.list.children.length-1:this.current+=-1,this}scrollToView(e){const n=e.offsetTop,i=this.list.scrollTop;n<i&&(this.list.scrollTop=n);const r=this.list.clientHeight,o=e.clientHeight;return n+o>i+r&&(this.list.scrollTop=n-r+o),this}goto(e){const n=this.list.children,i=n[e];return e>-1&&n.length>0?this.scrollToView(i):this.scrollToView(n[0]),this}opened(){return!this.closed()}closed(){return this.fsm.state.matches("closed")}createUnhide(){const e=Ht(this.scope,this.options.unhide,()=>{const n=this.options.document.createElement("p");return n.innerText=this.options.msgUnhide,n.setAttribute("role","button"),n.setAttribute("tabindex","0"),this.options.unhideClass&&(n.className=this.options.unhideClass),n});return e.addEventListener("click",this.unhideEvent),e}unmountUnhide(){this.unhide.removeEventListener("click",this.unhideEvent),this.options.unhide==null&&this.options.hide.length&&$i(this.unhide)}hiddenFields(){return this.options.hide.map(e=>j(e)?Ii(this.options.scope,e):e).filter(e=>e!==null)}hideFields(){this.hiddenFields().forEach(Z)}unhideFields(){this.hiddenFields().forEach(Ut),this.options.onUnhide.call(this)}}const wr=t=>function(){t.options.onBlur.call(t),t.fsm.send({type:"CLOSE",reason:"blur"})},_r=t=>function(e){t.options.onFocus.call(t),t.fsm.send("AWAKE")},Sr=t=>function(e){if(t.query().toLowerCase()===":c")return O(t.input,""),t.fsm.send({type:"CHANGE_COUNTRY"});t.fsm.send({type:"INPUT",event:e})},Tr=t=>function(e){e.preventDefault(),t.fsm.send({type:"CHANGE_COUNTRY"})},Ar=t=>function(e){const n=mr(e);if(n==="Enter"&&e.preventDefault(),t.options.onKeyDown.call(t,e),t.closed())return t.fsm.send("AWAKE");if(t.fsm.state.matches("suggesting_country")){if(n==="Enter"){const i=t.filteredContexts()[t.current];i&&t.fsm.send({type:"SELECT_COUNTRY",contextDetails:i})}n==="Backspace"&&t.fsm.send({type:"INPUT",event:e}),n==="ArrowUp"&&(e.preventDefault(),t.fsm.send("PREVIOUS")),n==="ArrowDown"&&(e.preventDefault(),t.fsm.send("NEXT"))}if(t.fsm.state.matches("suggesting")){if(n==="Enter"){const i=t.suggestions[t.current];i&&t.fsm.send({type:"SELECT_ADDRESS",suggestion:i})}n==="Backspace"&&t.fsm.send({type:"INPUT",event:e}),n==="ArrowUp"&&(e.preventDefault(),t.fsm.send("PREVIOUS")),n==="ArrowDown"&&(e.preventDefault(),t.fsm.send("NEXT"))}n==="Escape"&&t.fsm.send({type:"CLOSE",reason:"esc"}),n==="Home"&&t.fsm.send({type:"RESET"}),n==="End"&&t.fsm.send({type:"RESET"})},Lr=t=>function(e){if(e.target===null)return;const n=e.target;if(!n)return;let i=Or(n.value,t.options.contexts);t.fsm.send({type:"COUNTRY_CHANGE_EVENT",contextDetails:i})},Ht=(t,e,n)=>j(e)?t.querySelector(e):n&&e===null?n():e,Ir=(t,e,n)=>{const i=(o,s)=>{if(o===null)return;const a=o.getBoundingClientRect();s.style.minWidth=`${Math.round(a.width)}px`},r=e.parentElement;t.style.position="fixed",t.style.left="auto",i(r,t),n.defaultView!==null&&n.defaultView.addEventListener("resize",()=>{i(r,t)})},Or=(t,e)=>{const n=t.toUpperCase();for(const i of Object.values(e))if(i.iso_3===n||i.iso_2===n||i.description.toUpperCase()===n)return i},xt=t=>{const e=new _e(t);return Se.push(e),e},kr=(t,e)=>new Promise((n,i)=>{(e||document).addEventListener("DOMContentLoaded",r=>{const o=xt(t);return n(o)})}).catch(n=>null),Se=[],$r=()=>!0,Nr=(t,e)=>{const i=ge(t.scope||null).querySelectorAll(t.anchor||t.inputField||(t.outputFields||{}).line_1);return _i(i).filter(r=>!Si(r,e))},Pr=1e3,Ur=t=>Li(t,"FORM"),Rr=(t,e={})=>{const n=new fe({api_key:t.apiKey}),{pageTest:i=$r}=e;return i()?pe({client:n}).then(r=>{if(!r.available)return null;const{getScope:o=Ur,interval:s=Pr,anchor:a,onBind:l=f,onAnchorFound:u=f,onBindAttempt:d=f,immediate:h=!0,marker:b="idpc"}=e,v=()=>{d({config:t,options:e}),Nr({anchor:a,...t},b).forEach(C=>{const g=o(C);if(!g)return;const S=te(r.contexts),E={scope:g,...t,checkKey:!1,contexts:S};u({anchor:C,scope:g,config:E});const m=xt(E),w=m.options.contexts[r.context];m.options.detectCountry&&w?m.applyContext(w,!1):m.applyContext(m.currentContext(),!1),Ti(C,b),l(m)})},{start:x,stop:_}=Pi({bind:v,pageTest:i,interval:s});return h&&x(),{start:x,stop:_,bind:v}}).catch(r=>(e.onError&&e.onError(r),null)):Promise.resolve(null)},jr={setup:xt,controllers:Se,Controller:_e,defaults:ht,watch:Rr,go:kr},Fr=Pe(),D=window._K||{str:{},route:{}},c={addingMarkers:!1,buttons:{},markers:[],hasLoc:!!A.urlParam("lat"),center:{lat:Number(A.urlParam("lat")||53.2764),lng:Number(A.urlParam("lng")||-3.22189)},hasZoom:!!A.urlParam("zoom"),zoom:Number(A.urlParam("zoom")||14)};(async()=>{const t=await Kt("/google"),e=new U({apiKey:t.api,version:"weekly"});c.core=await e.importLibrary("core"),c.maps=await e.importLibrary("maps"),c.marker=await e.importLibrary("marker"),c.places=await e.importLibrary("places"),c.infos=await Kt("/info"),c.map=new c.maps.Map(document.getElementById("map"),{center:c.center,zoom:c.zoom,mapId:t.id,mapTypeId:c.maps.MapTypeId.ROADMAP,streetViewControl:!1,mapTypeControl:!1}),c.infoWindow=new c.maps.InfoWindow;const n=$("<div />",{class:"flex flex-col justify-center items-center rounded-sm shadow-[#0000004d_0px_1px_4px_-1px] bg-white mr-2.5"});c.buttons.add=Wt("fa-regular fa-location-plus text-xl border-b","Add marker!"),c.buttons.pos=Wt("fa-regular fa-circle-dot text-base","Geolocation!"),n.append(c.buttons.add),n.append(c.buttons.pos),c.map.controls[c.core.ControlPosition.RIGHT_TOP].push(n[0]),c.map.addListener("click",r=>{c.addingMarkers&&($("#infoBtn").trigger("click"),$("#lat").val(r.latLng.lat().toFixed(5)),$("#lng").val(r.latLng.lng().toFixed(5)),zt(r.latLng))}),c.core.event.addListener(c.map,"zoom_changed",Bt),c.core.event.addListener(c.map,"dragend",function(){A.addURLParam("lat",c.map.center.lat().toFixed(5)),A.addURLParam("lng",c.map.center.lng().toFixed(5))}),c.infos.forEach(r=>{zt(new c.core.LatLng(r.position.lat,r.position.lng),r,!1)}),c.buttons.add.on("click",Te),c.buttons.pos.on("click",qt),!c.hasLoc&&qt(),Bt();const i=new c.marker.AdvancedMarkerElement({map:c.map,content:$("<i />",{class:"fa-duotone fa-circle-dot text-blue-500 text-lg"})[0]});Kr({onSuccess:({coords:{latitude:r,longitude:o}})=>i.position=new c.core.LatLng(r,o)}),Mr()})();function Mr(){const t=$("#map-search"),e=$("#search-card"),n=new c.marker.AdvancedMarkerElement;c.map.controls[c.core.ControlPosition.TOP_LEFT].push(e[0]),setTimeout(()=>{e.removeClass("hidden")},2e3),jr.setup({apiKey:"ak_luen9mkza3ZJx0FpImxZ0BKxKqOMe",inputField:"#map-search",onAddressRetrieved:i=>{n.map=null;const r=new c.core.LatLng(i.latitude,i.longitude),o=[i.line_1||"",i.line_2||"",i.line_3||"",i.postal_town,i.postcode];let s="";o.forEach(a=>{s+=`${a?`${s?", ":""}${a}`:""}`}),t.val(s),c.map.setCenter(r),c.map.setZoom(17),n.position=r,n.map=c.map},containerClass:"relative",mainClass:"absolute shadow-sm z-50 mt-2 w-full rounded-md border border-gray-300 bg-white overflow-hidden",listClass:"max-h-40 overflow-y-auto [&>li]:cursor-pointer [&>li:not(:last-child)]:border-b [&>li]:border-gray-300 [&>li]:px-4 [&>li]:py-1 [&>li]:text-base hover:[&>li]:bg-gray-100",messageClass:"!cursor-default italic hover:!bg-transparent",toolbarClass:"flex items-center justify-end border-t border-gray-300 bg-gray-100 px-3 py-1",countryToggleClass:"hover-first flex cursor-pointer items-center gap-2 whitespace-nowrap text-sm [&>*:first-child]:block [&>*:first-child]:overflow-hidden [&>*:first-child]:transition-all [&>*:last-child]:bg-gray-100 [&>*:last-child]:text-base [&>*:last-child]:font-bold [&>*]:align-baseline"})}async function Kt(t){return await(await fetch(t)).json()}function Bt(){const t=c.map.getZoom().toFixed(2);A.addURLParam("zoom",t),A.each(c.markers,(e,n)=>n.map=t>=16?c.map:null)}function Te(){c.addingMarkers?(c.map.setOptions({draggableCursor:""}),c.buttons.add.removeClass("text-blue-500").addClass("text-blue-700"),c.addingMarkers=!1):(c.map.setOptions({draggableCursor:`url(${$("#markerSrc").attr("src")}), auto`}),c.buttons.add.addClass("text-blue-500").removeClass("text-blue-700"),c.addingMarkers=!0)}function qt(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const e=new c.core.LatLng(t.coords.latitude,t.coords.longitude);c.map.setCenter(e),c.map.setZoom(17)},()=>{Yt(!0,c.infoWindow.getPosition())}):Yt(!1,c.map.getCenter())}function zt(t,e=null,n=!0){const i=new c.marker.AdvancedMarkerElement({position:t,map:c.map,content:Hr(e)});c.markers.push(i),n&&(Te(),c.map.panTo(t));let r={};e&&(r={"title.text":D.str.editLocation,"form.action":D.route.infoUpdate,"method.value":"PATCH","id.value":e.id,"lat.value":e.position.lat,"lng.value":e.position.lng,"address.value":e.address,"name.value":e.name,"year.value":e.year,"note.value":e.note,"destroy.removeclass":"hidden","destroy.data":{modal:{"id.value":e.id}},"submit.text":D.str.save},A.isIn(e.creator,[D.str.username,"Kraig Larner"])||(r["destroy.addclass"]="hidden",r["destroy.data"]={modal:{"id.value":""}},delete r["destroy.removeclass"])),i.addListener("click",o=>{const s=$(o.domEvent.srcElement);if(s.hasClass("edit")){$("#editBtn").data("modal",r).trigger("click");return}if(s.hasClass("name")){Gr(s.data("name"));return}if(s.hasClass("move")&&(i.gmpDraggable?(i.content.classList.remove("moving"),i.gmpDraggable=!1):(i.content.classList.add("moving"),i.gmpDraggable=!0)),s.hasClass("changes")){$(".changesBtn").data("modal",{"tbody.changes":e.changes}).trigger("click");return}Dr(i)}),i.addListener("dragend",o=>{e&&i.content.classList.contains("moving")&&Fr.run(()=>{$.ajax({url:D.route.infoLocation,method:"POST",data:{id:e.id,lat:o.latLng.lat().toFixed(5),lng:o.latLng.lng().toFixed(5),_method:"PATCH",_token:$('[name="_token"]').first().val()}}).done(function(s){})},2e3)})}function Dr(t){t.content.classList.contains("highlight")?(t.content.classList.remove("highlight"),t.zIndex=null):(t.content.classList.add("highlight"),t.zIndex=1)}async function Gr(t){try{await navigator.clipboard.writeText(t),console.log("Copied to clipboard")}catch(e){console.error("Could not copy text: ",e)}}function Hr(t=null){const e=$("<div />",{class:"marker"});let n=$("<i />");if(t&&t.name&&t.year?n.addClass("fa-solid fa-user"):n.addClass("fa-solid fa-note"),e.append($("<div />",{class:"icon",html:n})),t){const i=$("<div />",{class:"details"}).appendTo(e);if($("<div />",{class:"title",text:D.str.locationInformation}).appendTo(i),t.address&&$("<div />",{class:"address",text:t.address}).appendTo(i),t.name&&t.year){const s=$("<div />",{class:"name-wrap"}).appendTo(i);$("<div />",{class:"name",data:{name:t.name},html:'<span class="pointer-events-none">'+t.name+'</span><i class="pointer-events-none fa-regular fa-copy">'}).appendTo(s),$("<div />",{class:"year",text:t.year}).appendTo(s)}t.note&&$("<div />",{class:"note",text:t.note}).appendTo(i);const r=$("<div />",{class:"footer"}).appendTo(i),o=$("<div />",{class:"btns text-lg sm:text-sm flex gap-4 sm:gap-2"}).appendTo(r);$("<i />",{class:"edit fa-regular fa-edit cursor-pointer text-amber-500"}).appendTo(o),$("<i />",{class:"move fa-regular fa-arrows-up-down-left-right cursor-pointer text-emerald-500"}).appendTo(o),t.changes.length&&$("<i />",{class:"changes far fa-rotate cursor-pointer text-sky-500"}).appendTo(o),$("<div />",{class:"creator",text:t.creator}).appendTo(r)}return e[0]}function Wt(t,e){return $("<button />",{class:t+" text-center text-gray-500 hover:text-gray-700 w-10 h-10 transition",title:e,type:"button"})}function Yt(t,e){c.infoWindow.setPosition(e),c.infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),c.infoWindow.open(c.map)}function Kr({onSuccess:t,onError:e=()=>{}}){return"geolocation"in navigator?navigator.geolocation.watchPosition(t,e):e(new Error("Geolocation is not supported by this browser."))}
