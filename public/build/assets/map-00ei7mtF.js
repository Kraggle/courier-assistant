import{K as d,t as N}from"./K-VLVDadFl.js";function z(t,e,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function c(l){try{u(n.next(l))}catch(p){s(p)}}function h(l){try{u(n.throw(l))}catch(p){s(p)}}function u(l){l.done?a(l.value):i(l.value).then(c,h)}u((n=n.apply(t,e||[])).next())})}function K(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var B=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,i,a;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(i=n;i--!==0;)if(!t(e[i],r[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(a=Object.keys(e),n=a.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,a[i]))return!1;for(i=n;i--!==0;){var s=a[i];if(!t(e[s],r[s]))return!1}return!0}return e!==e&&r!==r},F=K(B);const x="__googleMapsScriptId";var g;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(g||(g={}));class m{constructor({apiKey:e,authReferrerPolicy:r,channel:n,client:i,id:a=x,language:s,libraries:c=[],mapIds:h,nonce:u,region:l,retries:p=3,url:b="https://maps.googleapis.com/maps/api/js",version:v}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=r,this.channel=n,this.client=i,this.id=a||x,this.language=s,this.libraries=c,this.mapIds=h,this.nonce=u,this.region=l,this.retries=p,this.url=b,this.version=v,m.instance){if(!F(this.options,m.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(m.instance.options)}`);return m.instance}m.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?g.FAILURE:this.done?g.SUCCESS:this.loading?g.LOADING:g.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,r)=>{this.loadCallback(n=>{n?r(n.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,r;if(document.getElementById(this.id)){this.callback();return}const n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(a=>!n[a]&&delete n[a]),!((r=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.maps)===null||r===void 0)&&r.importLibrary||(a=>{let s,c,h,u="The Google Maps JavaScript API",l="google",p="importLibrary",b="__ib__",v=document,y=window;y=y[l]||(y[l]={});const w=y.maps||(y.maps={}),P=new Set,k=new URLSearchParams,U=()=>s||(s=new Promise((C,L)=>z(this,void 0,void 0,function*(){var E;yield c=v.createElement("script"),c.id=this.id,k.set("libraries",[...P]+"");for(h in a)k.set(h.replace(/[A-Z]/g,D=>"_"+D[0].toLowerCase()),a[h]);k.set("callback",l+".maps."+b),c.src=this.url+"?"+k,w[b]=C,c.onerror=()=>s=L(Error(u+" could not load.")),c.nonce=this.nonce||((E=v.querySelector("script[nonce]"))===null||E===void 0?void 0:E.nonce)||"",v.head.append(c)})));w[p]?console.warn(u+" only loads once. Ignoring:",a):w[p]=(C,...L)=>P.add(C)&&U().then(()=>w[p](C,...L))})(n);const i=this.libraries.map(a=>this.importLibrary(a));i.length||i.push(this.importLibrary("core")),Promise.all(i).then(()=>this.callback(),a=>{const s=new ErrorEvent("error",{error:a});this.loadErrorCallback(s)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const r=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${r} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},r)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setScript())}}}const W=()=>typeof window<"u";let T={};W()&&(window.idpcGlobal?T=window.idpcGlobal:window.idpcGlobal=T);var I={};Object.defineProperty(I,"__esModule",{value:!0});I.capitalisePostTown=void 0;var Z=/^(of|le|upon|on|the)$/,q=/\w+&\w+/,R=function(t){return t=t.toLowerCase(),t.match(Z)?t:t.match(q)?t.toUpperCase():t.charAt(0).toUpperCase()+t.slice(1)},J=/-/,H=/^(in|de|under|upon|y|on|over|the|by)$/,V=function(t){return t.match(J)===null?t:t.split("-").map(function(e){return e.match(H)?e.toLowerCase():R(e)}).join("-")},Y=/bo'ness/i,Q=/bfpo/i,X=function(t){return t.match(Y)?"Bo'Ness":t.match(Q)?"BFPO":t},ee=function(t){return t.split(" ").map(R).map(V).map(X).join(" ")};I.capitalisePostTown=ee;const te=N(),f=window._K||{str:{},route:{}},o={addingMarkers:!1,buttons:{},markers:[],hasLoc:!!d.urlParam("lat"),center:{lat:Number(d.urlParam("lat")||53.2764),lng:Number(d.urlParam("lng")||-3.22189)},hasZoom:!!d.urlParam("zoom"),zoom:Number(d.urlParam("zoom")||14)};(async()=>{const t=await S("/google"),e=new m({apiKey:t.api,version:"weekly"});o.core=await e.importLibrary("core"),o.maps=await e.importLibrary("maps"),o.marker=await e.importLibrary("marker"),o.places=await e.importLibrary("places"),o.infos=await S("/info"),console.log(o),o.map=new o.maps.Map(document.getElementById("map"),{center:o.center,zoom:o.zoom,mapId:t.id,mapTypeId:o.maps.MapTypeId.ROADMAP,streetViewControl:!1,mapTypeControl:!1}),o.infoWindow=new o.maps.InfoWindow;const r=$("<div />",{class:"flex flex-col justify-center items-center rounded-sm shadow-sm bg-white mr-2"});o.buttons.add=j("fa-regular fa-location-plus text-xl border-b","Add marker!"),o.buttons.pos=j("fa-regular fa-circle-dot text-base","Geolocation!"),r.append(o.buttons.add),r.append(o.buttons.pos),o.map.controls[o.core.ControlPosition.RIGHT_CENTER].push(r[0]),o.map.addListener("click",i=>{o.addingMarkers&&($("#infoBtn").trigger("click"),$("#lat").val(i.latLng.lat()),$("#lng").val(i.latLng.lng()),O(i.latLng))}),o.core.event.addListener(o.map,"zoom_changed",_),o.core.event.addListener(o.map,"dragend",function(){d.addURLParam("lat",o.map.center.lat()),d.addURLParam("lng",o.map.center.lng())}),o.infos.forEach(i=>{O(new o.core.LatLng(i.position.lat,i.position.lng),i,!1)}),o.buttons.add.on("click",G),o.buttons.pos.on("click",A),!o.hasLoc&&A(),_();const n=new o.marker.AdvancedMarkerElement({map:o.map,content:$("<i />",{class:"fa-duotone fa-circle-dot text-blue-500 text-lg"})[0]});ae({onSuccess:({coords:{latitude:i,longitude:a}})=>{n.position={lat:i,lng:a}}}),oe()})();function oe(){const t=$("#map-search"),e=$("#search-card").detach(),r=new o.places.Autocomplete(t[0],{strictBounds:!1,fields:["formatted_address","geometry","name"]}),n=new o.marker.AdvancedMarkerElement;o.map.controls[o.core.ControlPosition.TOP_LEFT].push(e[0]),e.removeClass("hidden"),r.addListener("place_changed",()=>{n.map=null;const i=r.getPlace();!i.geometry||!i.geometry.location||(i.geometry.viewport?o.map.fitBounds(i.geometry.viewport):(o.map.setCenter(i.geometry.location),o.map.setZoom(17)),n.position=i.geometry.location,n.map=o.map,console.log(i))})}async function S(t){return await(await fetch(t)).json()}function _(){const t=o.map.getZoom();d.addURLParam("zoom",t),d.each(o.markers,(e,r)=>r.map=t>=16?o.map:null)}function G(){o.addingMarkers?(o.map.setOptions({draggableCursor:""}),o.buttons.add.removeClass("text-blue-500").addClass("text-blue-700"),o.addingMarkers=!1):(o.map.setOptions({draggableCursor:`url(${$("#markerSrc").attr("src")}), auto`}),o.buttons.add.addClass("text-blue-500").removeClass("text-blue-700"),o.addingMarkers=!0)}function A(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const e=new o.core.LatLng(t.coords.latitude,t.coords.longitude);o.map.setCenter(e),o.map.setZoom(17)},()=>{M(!0,o.infoWindow.getPosition())}):M(!1,o.map.getCenter())}function O(t,e=null,r=!0){const n=new o.marker.AdvancedMarkerElement({position:t,map:o.map,content:ie(e)});o.markers.push(n),r&&(G(),o.map.panTo(t));let i={};e&&(i={"title.text":f.str.editLocation,"form.action":f.route.infoUpdate,"method.value":"PATCH","id.value":e.id,"lat.value":e.position.lat,"lng.value":e.position.lng,"address.value":e.address,"name.value":e.name,"year.value":e.year,"note.value":e.note,"destroy.removeclass":"hidden","destroy.data":{modal:{"id.value":e.id}},"submit.text":f.str.save},d.isIn(e.creator,[f.str.username,"Kraig Larner"])||(i["destroy.addclass"]="hidden",i["destroy.data"]={modal:{"id.value":""}},delete i["destroy.removeclass"])),n.addListener("click",a=>{const s=$(a.domEvent.srcElement);if(s.hasClass("edit")){$("#editBtn").data("modal",i).trigger("click");return}if(s.hasClass("name")){ne(s.data("name"));return}if(s.hasClass("move")&&(n.gmpDraggable?(n.content.classList.remove("moving"),n.gmpDraggable=!1):(n.content.classList.add("moving"),n.gmpDraggable=!0)),s.hasClass("changes")){$(".changesBtn").data("modal",{"tbody.changes":e.changes}).trigger("click");return}re(n)}),n.addListener("dragend",a=>{e&&n.content.classList.contains("moving")&&te.run(()=>{$.ajax({url:f.route.infoLocation,method:"POST",data:{id:e.id,lat:a.latLng.lat(),lng:a.latLng.lng(),_method:"PATCH",_token:$('[name="_token"]').first().val()}}).done(function(s){console.log(s)})},2e3)})}function re(t){t.content.classList.contains("highlight")?(t.content.classList.remove("highlight"),t.zIndex=null):(t.content.classList.add("highlight"),t.zIndex=1)}async function ne(t){try{await navigator.clipboard.writeText(t),console.log("Copied to clipboard")}catch(e){console.error("Could not copy text: ",e)}}function ie(t=null){const e=$("<div />",{class:"marker"});let r=$("<i />");if(t&&t.name&&t.year?r.addClass("fa-solid fa-user"):r.addClass("fa-solid fa-note"),e.append($("<div />",{class:"icon",html:r})),t){const n=$("<div />",{class:"details"}).appendTo(e);if($("<div />",{class:"title",text:f.str.locationInformation}).appendTo(n),t.address&&$("<div />",{class:"address",text:t.address}).appendTo(n),t.name&&t.year){const s=$("<div />",{class:"name-wrap"}).appendTo(n);$("<div />",{class:"name",data:{name:t.name},html:'<span class="pointer-events-none">'+t.name+'</span><i class="pointer-events-none fa-regular fa-copy">'}).appendTo(s),$("<div />",{class:"year",text:t.year}).appendTo(s)}t.note&&$("<div />",{class:"note",text:t.note}).appendTo(n);const i=$("<div />",{class:"footer"}).appendTo(n),a=$("<div />",{class:"btns text-lg sm:text-sm flex gap-4 sm:gap-2"}).appendTo(i);$("<i />",{class:"edit fa-regular fa-edit cursor-pointer text-amber-500"}).appendTo(a),$("<i />",{class:"move fa-regular fa-arrows-up-down-left-right cursor-pointer text-emerald-500"}).appendTo(a),t.changes.length&&$("<i />",{class:"changes far fa-rotate cursor-pointer text-sky-500"}).appendTo(a),$("<div />",{class:"creator",text:t.creator}).appendTo(i)}return e[0]}function j(t,e){return $("<button />",{class:t+" text-center text-gray-500 hover:text-gray-700 w-10 h-10 transition",title:e,type:"button"})}function M(t,e){o.infoWindow.setPosition(e),o.infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),o.infoWindow.open(o.map)}function ae({onSuccess:t,onError:e=()=>{}}){return"geolocation"in navigator?navigator.geolocation.watchPosition(t,e):e(new Error("Geolocation is not supported by this browser."))}
