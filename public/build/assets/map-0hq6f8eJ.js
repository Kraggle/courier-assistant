import{c as V,g as Pe,A as Ue,K as S,t as Re}from"./K-2SipYZUg.js";function je(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(i.next(d))}catch(h){o(h)}}function l(d){try{u(i.throw(d))}catch(h){o(h)}}function u(d){d.done?s(d.value):r(d.value).then(a,l)}u((i=i.apply(t,e||[])).next())})}function Fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Me=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(e)){if(i=e.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(s=Object.keys(e),i=s.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;r--!==0;){var o=s[r];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n},De=Fe(Me);const wt="__googleMapsScriptId";var G;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(G||(G={}));class R{constructor({apiKey:e,authReferrerPolicy:n,channel:i,client:r,id:s=wt,language:o,libraries:a=[],mapIds:l,nonce:u,region:d,retries:h=3,url:b="https://maps.googleapis.com/maps/api/js",version:v}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=n,this.channel=i,this.client=r,this.id=s||wt,this.language=o,this.libraries=a,this.mapIds=l,this.nonce=u,this.region=d,this.retries=h,this.url=b,this.version=v,R.instance){if(!De(this.options,R.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(R.instance.options)}`);return R.instance}R.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?G.FAILURE:this.done?G.SUCCESS:this.loading?G.LOADING:G.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,n)=>{this.loadCallback(i=>{i?n(i.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,n;if(document.getElementById(this.id)){this.callback();return}const i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach(s=>!i[s]&&delete i[s]),!((n=(e=window==null?void 0:window.google)===null||e===void 0?void 0:e.maps)===null||n===void 0)&&n.importLibrary||(s=>{let o,a,l,u="The Google Maps JavaScript API",d="google",h="importLibrary",b="__ib__",v=document,x=window;x=x[d]||(x[d]={});const _=x.maps||(x.maps={}),E=new Set,g=new URLSearchParams,T=()=>o||(o=new Promise((C,m)=>je(this,void 0,void 0,function*(){var w;yield a=v.createElement("script"),a.id=this.id,g.set("libraries",[...E]+"");for(l in s)g.set(l.replace(/[A-Z]/g,p=>"_"+p[0].toLowerCase()),s[l]);g.set("callback",d+".maps."+b),a.src=this.url+"?"+g,_[b]=C,a.onerror=()=>o=m(Error(u+" could not load.")),a.nonce=this.nonce||((w=v.querySelector("script[nonce]"))===null||w===void 0?void 0:w.nonce)||"",v.head.append(a)})));_[h]?console.warn(u+" only loads once. Ignoring:",s):_[h]=(C,...m)=>E.add(C)&&T().then(()=>_[h](C,...m))})(i);const r=this.libraries.map(s=>this.importLibrary(s));r.length||r.push(this.importLibrary("core")),Promise.all(r).then(()=>this.callback(),s=>{const o=new ErrorEvent("error",{error:s});this.loadErrorCallback(o)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const n=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${n} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},n)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setScript())}}}function Ge(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Vt=Ge,He=typeof V=="object"&&V&&V.Object===Object&&V,Ke=He,Be=Ke,qe=typeof self=="object"&&self&&self.Object===Object&&self,ze=Be||qe||Function("return this")(),Zt=ze,We=Zt,Ye=function(){return We.Date.now()},Ve=Ye,Ze=/\s/;function Je(t){for(var e=t.length;e--&&Ze.test(t.charAt(e)););return e}var Xe=Je,Qe=Xe,tn=/^\s+/;function en(t){return t&&t.slice(0,Qe(t)+1).replace(tn,"")}var nn=en,rn=Zt,sn=rn.Symbol,Jt=sn,_t=Jt,Xt=Object.prototype,on=Xt.hasOwnProperty,an=Xt.toString,B=_t?_t.toStringTag:void 0;function cn(t){var e=on.call(t,B),n=t[B];try{t[B]=void 0;var i=!0}catch{}var r=an.call(t);return i&&(e?t[B]=n:delete t[B]),r}var ln=cn,un=Object.prototype,dn=un.toString;function hn(t){return dn.call(t)}var pn=hn,St=Jt,fn=ln,gn=pn,mn="[object Null]",yn="[object Undefined]",Tt=St?St.toStringTag:void 0;function bn(t){return t==null?t===void 0?yn:mn:Tt&&Tt in Object(t)?fn(t):gn(t)}var vn=bn;function xn(t){return t!=null&&typeof t=="object"}var En=xn,Cn=vn,wn=En,_n="[object Symbol]";function Sn(t){return typeof t=="symbol"||wn(t)&&Cn(t)==_n}var Tn=Sn,An=nn,At=Vt,Ln=Tn,Lt=NaN,In=/^[-+]0x[0-9a-f]+$/i,$n=/^0b[01]+$/i,On=/^0o[0-7]+$/i,kn=parseInt;function Nn(t){if(typeof t=="number")return t;if(Ln(t))return Lt;if(At(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=At(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=An(t);var n=$n.test(t);return n||On.test(t)?kn(t.slice(2),n?2:8):In.test(t)?Lt:+t}var Pn=Nn,Un=Vt,st=Ve,It=Pn,Rn="Expected a function",jn=Math.max,Fn=Math.min;function Mn(t,e,n){var i,r,s,o,a,l,u=0,d=!1,h=!1,b=!0;if(typeof t!="function")throw new TypeError(Rn);e=It(e)||0,Un(n)&&(d=!!n.leading,h="maxWait"in n,s=h?jn(It(n.maxWait)||0,e):s,b="trailing"in n?!!n.trailing:b);function v(p){var A=i,U=r;return i=r=void 0,u=p,o=t.apply(U,A),o}function x(p){return u=p,a=setTimeout(g,e),d?v(p):o}function _(p){var A=p-l,U=p-u,W=e-A;return h?Fn(W,s-U):W}function E(p){var A=p-l,U=p-u;return l===void 0||A>=e||A<0||h&&U>=s}function g(){var p=st();if(E(p))return T(p);a=setTimeout(g,_(p))}function T(p){return a=void 0,b&&i?v(p):(i=r=void 0,o)}function C(){a!==void 0&&clearTimeout(a),u=0,i=l=r=a=void 0}function m(){return a===void 0?o:T(st())}function w(){var p=st(),A=E(p);if(i=arguments,r=this,l=p,A){if(a===void 0)return x(l);if(h)return clearTimeout(a),a=setTimeout(g,e),v(l)}return a===void 0&&(a=setTimeout(g,e)),o}return w.cancel=C,w.flush=m,w}var Dn=Mn;const Qt=Pe(Dn),Gn="border:0px;padding:0px;",Hn="clip:rect(0px,0px,0px,0px);height:1px;margin-bottom:-1px;margin-right:-1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px",$t=(t,e)=>(t.id=e,t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t),Kn=({document:t,idA:e,idB:n})=>{const i=t.createElement("div");i.setAttribute("style",Gn+Hn);const r=$t(t.createElement("div"),e),s=$t(t.createElement("div"),n);i.appendChild(r),i.appendChild(s);let o=!0;const a=Qt(l=>{const u=o?r:s,d=o?s:r;o=!o,u.textContent=l,d.textContent=""},1500,{});return{container:i,announce:a}},Bn={GBR:{iso_2:"GB",iso_3:"GBR",emoji:"ðŸ‡¬ðŸ‡§",rgeo:!0,description:"United Kingdom"},USA:{iso_2:"US",iso_3:"USA",emoji:"ðŸ‡ºðŸ‡¸",rgeo:!1,description:"United States"}},qn=(t,e)=>{const n=[],i=Object.keys(t);for(const r of i)e.length>0&&!e.some(s=>s===r)||n.push(t[r]);return n.sort((r,s)=>r.description.localeCompare(s.description)),n},te=t=>{const e={};for(const n of t)e[n.iso_3]=n;return e},Ot={tls:!0,api_key:"",baseUrl:"api.ideal-postcodes.co.uk",version:"v1",strictAuthorisation:!1,timeout:1e4,header:{Accept:"application/json","Content-Type":"application/json"},tags:[],agent:{}};let zn=class{constructor(e){this.config={...Ot,...e},this.config.header={...Ot.header,...e.header&&e.header}}url(){const{baseUrl:e,version:n}=this.config;return`${this.protocol()}://${e}/${n}`}protocol(){return this.config.tls?"https":"http"}};const pt=t=>t===void 0?{}:Object.keys(t).reduce((e,n)=>{const i=t[n],r=Yn(i);return r.length>0&&(e[n]=r),e},{}),kt=t=>typeof t=="string",Wn=t=>Array.isArray(t),Yn=t=>{const e=[];return Wn(t)?(t.forEach(n=>{lt(n)&&e.push(n.toString()),kt(n)&&e.push(n)}),e.join(",")):lt(t)?t.toString():kt(t)?t:""},lt=t=>typeof t=="number",ee=({timeout:t},e)=>lt(t)?t:e.config.timeout,ne=({header:t={}},e)=>({...e.config.header,...pt(t)});let ft=class ie extends Error{constructor(e){const n=new.target.prototype;super(),this.__proto__=n;const{message:i,httpStatus:r,metadata:s={}}=e;this.message=i,this.name="Ideal Postcodes Error",this.httpStatus=r,this.metadata=s,Error.captureStackTrace&&Error.captureStackTrace(this,ie)}};class H extends ft{constructor(e){super({httpStatus:e.httpStatus,message:e.body.message}),this.response=e}}class re extends H{}class gt extends H{}class se extends gt{}class it extends H{}class oe extends it{}class ae extends it{}class K extends H{}class ce extends K{}class le extends K{}class ue extends K{}class de extends K{}class he extends H{}const Vn=200,Zn=300,Jn=400,Xn=401,Qn=4010,ti=402,ei=4020,ni=4021,ii=404,ri=4040,si=4042,oi=4044,ai=4046,ci=500,li=t=>!(t<Vn||t>=Zn),ui=t=>!(t===null||typeof t!="object"),di=t=>!(!ui(t)||typeof t.message!="string"||typeof t.code!="number"),mt=t=>{const{httpStatus:e,body:n}=t;if(!li(e)){if(di(n)){const{code:i}=n;if(i===Qn)return new se(t);if(i===ri)return new ce(t);if(i===si)return new le(t);if(i===oi)return new ue(t);if(i===ai)return new de(t);if(i===ei)return new oe(t);if(i===ni)return new ae(t);if(e===ii)return new K(t);if(e===Jn)return new re(t);if(e===ti)return new it(t);if(e===Xn)return new gt(t);if(e===ci)return new he(t)}return new ft({httpStatus:e,message:JSON.stringify(n)})}},hi=Object.freeze(Object.defineProperty({__proto__:null,IdealPostcodesError:ft,IdpcApiError:H,IdpcBadRequestError:re,IdpcBalanceDepletedError:oe,IdpcInvalidKeyError:se,IdpcKeyNotFoundError:le,IdpcLimitReachedError:ae,IdpcPostcodeNotFoundError:ce,IdpcRequestFailedError:it,IdpcResourceNotFoundError:K,IdpcServerError:he,IdpcUdprnNotFoundError:ue,IdpcUmprnNotFoundError:de,IdpcUnauthorisedError:gt,parse:mt},Symbol.toStringTag,{value:"Module"})),pi=(t,e)=>[t.client.url(),t.resource,encodeURIComponent(e),t.action].filter(n=>n!==void 0).join("/"),yt=t=>{const{client:e}=t;return(n,i)=>e.config.agent.http({method:"GET",url:pi(t,n),query:pt(i.query),header:ne(i,e),timeout:ee(i,e)}).then(r=>{const s=mt(r);if(s)throw s;return r})},fi=t=>{const{client:e,resource:n}=t;return i=>e.config.agent.http({method:"GET",url:`${e.url()}/${n}`,query:pt(i.query),header:ne(i,e),timeout:ee(i,e)}).then(r=>{const s=mt(r);if(s)throw s;return r})},gi="keys",mi=(t,e,n)=>yt({resource:gi,client:t})(e,n),pe=t=>{const{client:e,timeout:n}=t,i=t.api_key||t.client.config.api_key,{licensee:r}=t;let s;r===void 0?s={}:s={licensee:r};const o={query:s,header:{}};return n!==void 0&&(o.timeout=n),mi(e,i,o).then(a=>a.body.result)},bt="autocomplete/addresses",yi=(t,e)=>fi({resource:bt,client:t})(e),bi=(t,e,n)=>yt({resource:bt,client:t,action:"usa"})(e,n),vi=(t,e,n)=>yt({resource:bt,client:t,action:"gbr"})(e,n),{IdealPostcodesError:xi}=hi,Ei=t=>Object.keys(t).reduce((e,n)=>{const i=t[n];return typeof i=="string"?e[n]=i:Array.isArray(i)&&(e[n]=i.join(",")),e},{}),Nt=(t,e)=>({httpRequest:t,body:e.data,httpStatus:e.status||0,header:Ei(e.headers),metadata:{response:e}}),Pt=t=>{const e=new xi({message:`[${t.name}] ${t.message}`,httpStatus:0,metadata:{axios:t}});return Promise.reject(e)},Ci=()=>!0;class wi{constructor(){this.Axios=Ue.create({validateStatus:Ci})}requestWithBody(e){const{body:n,method:i,timeout:r,url:s,header:o,query:a}=e;return this.Axios.request({url:s,method:i,headers:o,params:a,data:n,timeout:r}).then(l=>Nt(e,l)).catch(Pt)}request(e){const{method:n,timeout:i,url:r,header:s,query:o}=e;return this.Axios.request({url:r,method:n,headers:s,params:o,timeout:i}).then(a=>Nt(e,a)).catch(Pt)}http(e){return e.body!==void 0?this.requestWithBody(e):this.request(e)}}class fe extends zn{constructor(e){const n=new wi;super({agent:n,...e})}}class _i{constructor(e){this.prefix="!",this.client=e,this.cache={}}key(e){return`${this.prefix}${e.toLowerCase()}`}retrieve(e){return this.cache[this.key(e)]}store(e,n){return this.cache[this.key(e)]=n,n}clear(){this.cache={}}query(e,n={}){const i=this.retrieve(e);if(i)return Promise.resolve(i);const r=yi(this.client,{query:{query:e,api_key:this.client.config.api_key,...n}}).then(s=>{const o=s.body.result.hits;return this.store(e,o),o});return this.store(e,r),r}resolve(e,n){return n==="usa"?this.usaResolve(e):this.gbrResolve(e)}usaResolve(e){return bi(this.client,e.id,{query:{api_key:this.client.config.api_key}}).then(n=>n.body.result)}gbrResolve(e){return vi(this.client,e.id,{query:{api_key:this.client.config.api_key}}).then(n=>n.body.result)}}const F=t=>typeof t=="string",Si=()=>typeof window<"u",Ti=t=>Array.prototype.slice.call(t),Ai=(t,e="idpc")=>t.getAttribute(e)==="true",Li=(t,e="idpc")=>t.setAttribute(e,"true"),Ii=()=>!0,$i=(t,e,n=Ii)=>{let i=t;const r=e.toUpperCase();for(;i.tagName!=="HTML";){if(i.tagName===r&&n(i))return i;if(i.parentNode===null)return null;i=i.parentNode}return null},Oi=(t,e)=>e?t.querySelector(e):null,I=(t,e)=>F(t)?e.querySelector(t):t,ut=()=>window.document,ge=t=>F(t)?ut().querySelector(t):t===null?ut():t,ki=t=>t instanceof Document||t.constructor.name==="HTMLDocument"?t:t.ownerDocument?t.ownerDocument:ut(),D=(t,e)=>{const n=t.getAttribute("style");return Object.keys(e).forEach(i=>t.style[i]=e[i]),n},Ni=(t,e)=>{t.setAttribute("style",e||"")},Z=t=>(t.style.display="none",t),Ut=t=>(t.style.display="",t),Pi=t=>{t===null||t.parentNode===null||t.parentNode.removeChild(t)},Ui=(t,e,n)=>{const i=t.querySelectorAll(e);for(let r=0;r<i.length;r++){const s=i[r],o=s.innerText;if(o&&o.trim()===n)return s}return null},Ri=({pageTest:t,bind:e,interval:n=1e3})=>{let i=null;const r=o=>t()?(i=window.setInterval(()=>{try{e(o)}catch(a){s(),console.log(a)}},n),i):null,s=()=>{i!==null&&(window.clearInterval(i),i=null)};return{start:r,stop:s}},ji=t=>{t=String(t);const e=t.length;let n=-1,i,r="";const s=t.charCodeAt(0);for(;++n<e;){if(i=t.charCodeAt(n),i==0){r+="ï¿½";continue}if(i>=1&&i<=31||i==127||n==0&&i>=48&&i<=57||n==1&&i>=48&&i<=57&&s==45){r+="\\"+i.toString(16)+" ";continue}if(n==0&&e==1&&i==45){r+="\\"+t.charAt(n);continue}if(i>=128||i==45||i==95||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122){r+=t.charAt(n);continue}r+="\\"+t.charAt(n)}return r},me=t=>t.post_town!==void 0,Fi=(t,e)=>{const n=e.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=t,n},Mi=(t,e)=>{const n=e.createElement("style");return n.type="text/css",n.appendChild(e.createTextNode(t)),e.head.appendChild(n),n},Di=({event:t,bubbles:e=!0,cancelable:n=!0})=>{if(typeof window.Event=="function")return new window.Event(t,{bubbles:e,cancelable:n});const i=document.createEvent("Event");return i.initEvent(t,e,n),i},Q=(t,e)=>t.dispatchEvent(Di({event:e})),tt=t=>t===null?!1:t instanceof HTMLSelectElement||t.constructor.name==="HTMLSelectElement",z=t=>t===null?!1:t instanceof HTMLInputElement||t.constructor.name==="HTMLInputElement",ye=t=>t===null?!1:t instanceof HTMLTextAreaElement||t.constructor.name==="HTMLTextAreaElement",k=(t,e,n=!1)=>{t&&(!z(t)&&!ye(t)||j({e:t,value:e,skipTrigger:n}))},q=(t,e)=>e===null?!1:t.querySelector(`[value="${e}"]`)!==null,Gi=({e:t,value:e,skipTrigger:n})=>{e!==null&&tt(t)&&(be(t,e),n||Q(t,"select"),Q(t,"change"))},be=(t,e)=>{const n=Object.getOwnPropertyDescriptor(t.constructor.prototype,"value");if(n===void 0||n.set===void 0)return;n.set.call(t,e)},Hi=({e:t,value:e,skipTrigger:n})=>{e!==null&&(!z(t)&&!ye(t)||(be(t,e),n||Q(t,"input"),Q(t,"change")))},j=t=>{t.value!==null&&(Gi(t),Hi(t))},J="United Kingdom",Rt="Isle of Man",Ki="England",Bi="Scotland",qi="Wales",zi="Northern Ireland",Wi="Channel Islands",jt=t=>{const e=t.country;if(e===Ki||e===Bi||e===qi||e===zi)return J;if(e===Rt)return Rt;if(me(t)&&e===Wi){if(/^GY/.test(t.postcode))return"Guernsey";if(/^JE/.test(t.postcode))return"Jersey"}return e},Yi=(t,e)=>{if(t){if(tt(t)){const n=jt(e);q(t,n)&&j({e:t,value:n}),q(t,e.country_iso_2)&&j({e:t,value:e.country_iso_2}),q(t,e.country_iso)&&j({e:t,value:e.country_iso})}if(z(t)){const n=jt(e);j({e:t,value:n})}}};let dt={};Si()&&(window.idpcGlobal?dt=window.idpcGlobal:window.idpcGlobal=dt);const ve=()=>dt,Vi=(t="idpc_")=>()=>{const e=ve();return e.idGen||(e.idGen={}),e.idGen[t]===void 0&&(e.idGen[t]=0),e.idGen[t]+=1,`${t}${e.idGen[t]}`};var vt={};Object.defineProperty(vt,"__esModule",{value:!0});var xe=vt.capitalisePostTown=void 0,Zi=/^(of|le|upon|on|the)$/,Ji=/\w+&\w+/,Ee=function(t){return t=t.toLowerCase(),t.match(Zi)?t:t.match(Ji)?t.toUpperCase():t.charAt(0).toUpperCase()+t.slice(1)},Xi=/-/,Qi=/^(in|de|under|upon|y|on|over|the|by)$/,tr=function(t){return t.match(Xi)===null?t:t.split("-").map(function(e){return e.match(Qi)?e.toLowerCase():Ee(e)}).join("-")},er=/bo'ness/i,nr=/bfpo/i,ir=function(t){return t.match(er)?"Bo'Ness":t.match(nr)?"BFPO":t},rr=function(t){return t.split(" ").map(Ee).map(tr).map(ir).join(" ")};xe=vt.capitalisePostTown=rr;const sr=t=>{const{line_2:e,line_3:n}=t;return e?n?3:2:1},et=t=>t.filter(e=>F(e)?!!e.trim():!!e).join(", "),ot=(t,e)=>{if(t.length<=e)return[t,""];const n=t.split(" ");let i="",r="";for(let s=0;s<n.length;s++){const o=n[s];if(i.length+o.length>e){r=n.slice(s).join(" ");break}i+=`${o} `}return[i.trim(),r.trim()]},at=(t,e)=>e.length===0?t:`${t}, ${e}`,or=(t,e)=>{const{lineCount:n,maxLineOne:i,maxLineTwo:r,maxLineThree:s}=e,o=["","",""],a=[...t];if(i){const[l,u]=ot(a[0],i);if(o[0]=l,u&&(a[1]=at(u,a[1])),n===1)return o}else if(o[0]=a[0],n===1)return[et(a),"",""];if(r){const[l,u]=ot(a[1],r);if(o[1]=l,u&&(a[2]=at(u,a[2])),n===2)return o}else if(o[1]=a[1],n===2)return[o[0],et(a.slice(1)),""];if(s){const[l,u]=ot(a[2],s);o[2]=l,u&&(a[3]=at(u,a[3]))}else o[2]=a[2];return o},ar=(t,e,n)=>{const{line_1:i,line_2:r}=e,s="line_3"in e?e.line_3:"";return n.maxLineOne||n.maxLineTwo||n.maxLineThree?or([i,r,s],{lineCount:t,...n}):t===3?[i,r,s]:t===2?[i,et([r,s]),""]:[et([i,r,s]),"",""]},cr=(t,e)=>{const n=t[e];return typeof n=="number"?n.toString():n===void 0?"":n},lr=t=>({...t.outputFields,...dr(t.names||{},t.config.scope),...hr(t.labels||{},t.config.scope)}),ur=(t,e,n,i)=>{const[r,s,o]=ar(sr(t),e,i);k(I(t.line_1||null,n),r),k(I(t.line_2||null,n),s),k(I(t.line_3||null,n),o)},dr=(t,e)=>{const n={};let i;for(i in t){if(!t.hasOwnProperty(i))continue;const r=t[i],s=I(`[name="${r}"]`,e);if(s){n[i]=s;continue}const o=I(`[aria-name="${r}"]`,e);o&&(n[i]=o)}return n},hr=(t,e)=>{const n={};if(t===void 0)return t;let i;for(i in t){if(!t.hasOwnProperty(i))continue;const r=t[i];if(!r)continue;const s=Ui(e,"label",r),o=I(s,e);if(!o)continue;const a=o.getAttribute("for");if(a){const u=e.querySelector(`#${ji(a)}`);if(u){n[i]=u;continue}}const l=o.querySelector("input");l&&(n[i]=l)}return n},pr=t=>{const{config:e}=t,n={...t.address},{scope:i,titleizePostTown:r,populateOrganisation:s,populateCounty:o}=e,a=lr(t);me(n)&&(e.removeOrganisation&&fr(n),"post_town"in n&&r&&(n.post_town=xe(n.post_town)),s===!1&&delete n.organisation_name,o===!1&&delete n.county),ur(a,n,i,e),delete n.line_1,delete n.line_2,delete n.line_3,Yi(I(a.country||null,i),n),delete n.country;const l=I(a.country_iso_2||null,i);tt(l)&&q(l,n.country_iso_2)&&j({e:l,value:n.country_iso_2}),z(l)&&k(l,n.country_iso_2||""),delete n.country_iso_2;const u=I(a.country_iso||null,i);tt(u)&&q(u,n.country_iso)&&j({e:u,value:n.country_iso_2}),z(u)&&k(u,n.country_iso||""),delete n.country_iso;let d;for(d in a)if(n[d]!==void 0&&a.hasOwnProperty(d)){const h=a[d];if(!h)continue;k(I(h,i),cr(n,d))}},fr=t=>(t.organisation_name.length===0||t.line_2.length===0&&t.line_3.length===0||t.line_1===t.organisation_name&&(t.line_1=t.line_2,t.line_2=t.line_3,t.line_3=""),t),gr={13:"Enter",38:"ArrowUp",40:"ArrowDown",36:"Home",35:"End",27:"Escape",8:"Backspace"},mr=["Enter","ArrowUp","ArrowDown","Home","End","Escape","Backspace"],yr=t=>mr.indexOf(t)!==-1,br=t=>t.keyCode?gr[t.keyCode]||null:yr(t.key)?t.key:null,vr=".idpc_af.hidden{display:none}div.idpc_autocomplete{position:relative;margin:0!important;padding:0;border:0;color:#28282b;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}div.idpc_autocomplete>input{display:block}div.idpc_af{position:absolute;left:0;z-index:2000;min-width:100%;box-sizing:border-box;border-radius:3px;background:#fff;border:1px solid rgba(0,0,0,.3);box-shadow:.05em .2em .6em rgba(0,0,0,.2);text-shadow:none;padding:0;margin-top:2px}div.idpc_af>ul{list-style:none;padding:0;max-height:250px;overflow-y:scroll;margin:0!important}div.idpc_af>ul>li{position:relative;padding:.2em .5em;cursor:pointer;margin:0!important}div.idpc_toolbar{padding:.3em .5em;border-top:1px solid rgba(0,0,0,.3);text-align:right}div.idpc_af>ul>li:hover{background-color:#e5e4e2}div.idpc_af>ul>li.idpc_error{padding:.5em;text-align:center;cursor:default!important}div.idpc_af>ul>li.idpc_error:hover{background:#fff;cursor:default!important}div.idpc_af>ul>li[aria-selected=true]{background-color:#e5e4e2;z-index:3000}div.idpc_autocomplete>.idpc-unhide{font-size:.9em;text-decoration:underline;cursor:pointer}div.idpc_af>div>span{padding:.2em .5em;border-radius:3px;cursor:pointer;font-size:110%}span.idpc_icon{font-size:1.2em;line-height:1em;vertical-align:middle}div.idpc_toolbar>span span.idpc_country{margin-right:.3em;max-width:0;font-size:.9em;-webkit-transition:max-width .5s ease-out;transition:max-width .5s ease-out;display:inline-block;vertical-align:middle;white-space:nowrap;overflow:hidden}div.idpc_autocomplete>div>div>span:hover span.idpc_country{max-width:7em}div.idpc_autocomplete>div>div>span:hover{background-color:#e5e4e2;-webkit-transition:background-color .5s ease;-ms-transition:background-color .5s ease;transition:background-color .5s ease}",xr=t=>{const e=t.options.injectStyle;if(!e)return;const n=ve();if(n.afstyle||(n.afstyle={}),F(e)&&!n.afstyle[e]){n.afstyle[e]=!0;const i=Fi(e,t.document);return t.document.head.appendChild(i),i}if(e===!0&&!n.afstyle[""])return n.afstyle[""]=!0,Mi(vr,t.document)},Er=t=>{let e;const n=t.input;if(t.options.alignToInput===!1)return{};try{const s=t.options.document.defaultView;if(!s)return{};e=s.getComputedStyle(n).marginBottom}catch{return{}}if(!e)return{};const i=parseInt(e.replace("px",""),10);return isNaN(i)?{}:i===0?{}:{marginTop:i*-1+t.options.offset+"px"}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ct(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(e===void 0||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}var P;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(P||(P={}));var Ce={type:"xstate.init"};function X(t){return t===void 0?[]:[].concat(t)}function Ft(t,e){return typeof(t=typeof t=="string"&&e&&e[t]?e[t]:t)=="string"?{type:t}:typeof t=="function"?{type:t.name,exec:t}:t}function nt(t){return function(e){return t===e}}function we(t){return typeof t=="string"?{type:t}:t}function Mt(t,e){return{value:t,context:e,actions:[],changed:!1,matches:nt(t)}}function Dt(t,e,n){var i=e,r=!1;return[t.filter(function(s){if(s.type==="xstate.assign"){r=!0;var o=Object.assign({},i);return typeof s.assignment=="function"?o=s.assignment(i,n):Object.keys(s.assignment).forEach(function(a){o[a]=typeof s.assignment[a]=="function"?s.assignment[a](i,n):s.assignment[a]}),i=o,!1}return!0}),i,r]}function Cr(t,e){e===void 0&&(e={});var n=ct(Dt(X(t.states[t.initial].entry).map(function(o){return Ft(o,e.actions)}),t.context,Ce),2),i=n[0],r=n[1],s={config:t,_options:e,initialState:{value:t.initial,actions:i,context:r,matches:nt(t.initial)},transition:function(o,a){var l,u,d=typeof o=="string"?{value:o,context:t.context}:o,h=d.value,b=d.context,v=we(a),x=t.states[h];if(x.on){var _=X(x.on[v.type]);"*"in x.on&&_.push.apply(_,function(y,O,Y){if(Y||arguments.length===2)for(var N,M=0,Ne=O.length;M<Ne;M++)!N&&M in O||(N||(N=Array.prototype.slice.call(O,0,M)),N[M]=O[M]);return y.concat(N||Array.prototype.slice.call(O))}([],ct(X(x.on["*"])),!1));try{for(var E=function(y){var O=typeof Symbol=="function"&&Symbol.iterator,Y=O&&y[O],N=0;if(Y)return Y.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&N>=y.length&&(y=void 0),{value:y&&y[N++],done:!y}}};throw new TypeError(O?"Object is not iterable.":"Symbol.iterator is not defined.")}(_),g=E.next();!g.done;g=E.next()){var T=g.value;if(T===void 0)return Mt(h,b);var C=typeof T=="string"?{target:T}:T,m=C.target,w=C.actions,p=w===void 0?[]:w,A=C.cond,U=A===void 0?function(){return!0}:A,W=m===void 0,Ie=m??h,$e=t.states[Ie];if(U(b,v)){var rt=ct(Dt((W?X(p):[].concat(x.exit,p,$e.entry).filter(function(y){return y})).map(function(y){return Ft(y,s._options.actions)}),b,v),3),Et=rt[0],Oe=rt[1],ke=rt[2],Ct=m??h;return{value:Ct,context:Oe,actions:Et,changed:m!==h||Et.length>0||ke,matches:nt(Ct)}}}}catch(y){l={error:y}}finally{try{g&&!g.done&&(u=E.return)&&u.call(E)}finally{if(l)throw l.error}}}return Mt(h,b)}};return s}var Gt=function(t,e){return t.actions.forEach(function(n){var i=n.exec;return i&&i(t.context,e)})};function wr(t){var e=t.initialState,n=P.NotStarted,i=new Set,r={_machine:t,send:function(s){n===P.Running&&(e=t.transition(e,s),Gt(e,we(s)),i.forEach(function(o){return o(e)}))},subscribe:function(s){return i.add(s),s(e),{unsubscribe:function(){return i.delete(s)}}},start:function(s){if(s){var o=typeof s=="object"?s:{context:t.config.context,value:s};e={value:o.value,actions:[],context:o.context,matches:nt(o.value)}}else e=t.initialState;return n=P.Running,Gt(e,Ce),r},stop:function(){return n=P.Stopped,i.clear(),r},get state(){return e},get status(){return n}};return r}const _r=({c:t})=>{const e=Cr({initial:"closed",states:{closed:{entry:["close"],exit:["open"],on:{COUNTRY_CHANGE_EVENT:{actions:["updateContextWithCountry"]},AWAKE:[{target:"suggesting",cond:()=>t.suggestions.length>0},{target:"notifying"}]}},notifying:{entry:["renderNotice"],exit:["clearAnnouncement"],on:{CLOSE:"closed",SUGGEST:{target:"suggesting",actions:["updateSuggestions"]},NOTIFY:{target:"notifying",actions:["updateMessage"]},INPUT:{actions:"input"},CHANGE_COUNTRY:{target:"suggesting_country"}}},suggesting_country:{entry:["clearInput","renderContexts","gotoCurrent","expand","addCountryHint"],exit:["resetCurrent","gotoCurrent","contract","clearHint","clearInput"],on:{CLOSE:"closed",NOTIFY:{target:"notifying",actions:["updateMessage"]},NEXT:{actions:["next","gotoCurrent"]},PREVIOUS:{actions:["previous","gotoCurrent"]},RESET:{actions:["resetCurrent","gotoCurrent"]},INPUT:{actions:["countryInput"]},SELECT_COUNTRY:{target:"notifying",actions:["selectCountry"]}}},suggesting:{entry:["renderSuggestions","gotoCurrent","expand","addHint"],exit:["resetCurrent","gotoCurrent","contract","clearHint"],on:{CLOSE:"closed",SUGGEST:{target:"suggesting",actions:["updateSuggestions"]},NOTIFY:{target:"notifying",actions:["updateMessage"]},INPUT:{actions:"input"},CHANGE_COUNTRY:{target:"suggesting_country"},NEXT:{actions:["next","gotoCurrent"]},PREVIOUS:{actions:["previous","gotoCurrent"]},RESET:{actions:["resetCurrent","gotoCurrent"]},SELECT_ADDRESS:{target:"closed",actions:["selectAddress"]}}}}},{actions:{updateContextWithCountry:(n,i)=>{i.type==="COUNTRY_CHANGE_EVENT"&&i.contextDetails&&(t.applyContext(i.contextDetails),t.suggestions=[],t.cache.clear())},addHint:()=>{t.setPlaceholder(t.options.msgPlaceholder)},addCountryHint:()=>{t.setPlaceholder(t.options.msgPlaceholderCountry)},clearHint:()=>{t.unsetPlaceholder()},clearInput:()=>{t.clearInput()},gotoCurrent:()=>{t.goToCurrent()},resetCurrent:()=>{t.current=-1},input:(n,i)=>{i.type==="INPUT"&&t.retrieveSuggestions(i.event)},countryInput:()=>{t.renderContexts()},clearAnnouncement:()=>{t.announce("")},renderContexts:(n,i)=>{i.type==="CHANGE_COUNTRY"&&t.renderContexts()},renderSuggestions:(n,i)=>{i.type==="SUGGEST"&&t.renderSuggestions()},updateSuggestions:(n,i)=>{i.type==="SUGGEST"&&t.updateSuggestions(i.suggestions)},close:(n,i)=>{if(i.type==="CLOSE")return t.close(i.reason);t.close()},open:()=>{t.open()},expand:()=>{t.ariaExpand()},contract:()=>{t.ariaContract()},updateMessage:(n,i)=>{i.type==="NOTIFY"&&(t.notification=i.notification)},renderNotice:()=>{t.renderNotice()},next:()=>{t.next()},previous:()=>{t.previous()},selectCountry:(n,i)=>{if(i.type!=="SELECT_COUNTRY")return;const r=i.contextDetails;r&&(t.applyContext(r),t.notification=`Country switched to ${r.description} ${r.emoji}`)},selectAddress:(n,i)=>{if(i.type!=="SELECT_ADDRESS")return;const r=i.suggestion;r&&t.applySuggestion(r)}}});return wr(e)},f=()=>{},ht={outputScope:null,apiKey:"",checkKey:!0,aria:"1.0",titleizePostTown:!0,format:"gbr",outputFields:{},names:{},labels:{},removeOrganisation:!1,injectStyle:!0,inputField:"",autocomplete:"none",populateCounty:!0,populateOrganisation:!0,queryOptions:{},alignToInput:!0,offset:2,hideToolbar:!1,detectCountry:!0,defaultCountry:"GBR",restrictCountries:[],contexts:Bn,msgFallback:"Please enter your address manually",msgInitial:"Start typing to find address",msgNoMatch:"No matches found",msgList:"Select your address",msgCountryToggle:"Change Country",msgPlaceholder:"Type the first line or postal code of your address",msgPlaceholderCountry:"Select your country",messageClass:"idpc_error",containerClass:"idpc_autocomplete",mainClass:"idpc_af",listClass:"idpc_ul",toolbarClass:"idpc_toolbar",countryToggleClass:"idpc_country",mainStyle:{},inputStyle:{},listStyle:{},liStyle:{},containerStyle:{},unhide:null,unhideClass:"idpc-unhide",msgUnhide:"Enter address manually",hide:[],fixed:!1,onOpen:f,onSelect:f,onBlur:f,onClose:f,onFocus:f,onInput:f,onLoaded:f,onSearchError:f,onSuggestionError:f,onMounted:f,onRemove:f,onSuggestionsRetrieved:f,onAddressSelected:f,onAddressRetrieved:f,onAddressPopulated:f,onFailedCheck:f,onMouseDown:f,onKeyDown:f,onUnhide:f,onCountrySelected:f,onContextChange:f};class _e{constructor(e){this.options={scope:window.document,document:window.document,...ht,...e},e.inputField||(this.options.inputField=this.options.outputFields.line_1||""),this.options.autocomplete===!0&&(this.options.autocomplete=ht.autocomplete),this.scope=ge(this.options.scope),this.document=ki(this.scope),this.outputScope=Ht(this.scope,this.options.outputScope,()=>this.scope),this.context=this.options.defaultCountry,this.notification=this.options.msgInitial,this.current=-1,this.suggestions=[],this.contextSuggestions=[],this.updateContexts(this.options.contexts),this.client=new fe({...this.options,api_key:this.options.apiKey}),this.cache=new _i(this.client),this.retrieveSuggestions=Qt(a=>{this.options.onInput.call(this,a);const l=this.query();return l.trim().length===0?(this.setMessage(this.options.msgInitial),Promise.resolve(this)):this.cache.query(l,{...this.options.queryOptions,context:this.context}).then(u=>(this.options.onSuggestionsRetrieved.call(this,u),this.setSuggestions(u,l))).catch(u=>(this.query()===l&&this.setMessage(this.options.msgFallback),this.options.onSuggestionError.call(this,u),this))},100,{leading:!0,trailing:!0,maxWait:100}),this.ids=Vi("idpcaf"),this.container=this.options.document.createElement("div"),this.container.className=this.options.containerClass,this.container.id=this.ids(),this.container.setAttribute("aria-haspopup","listbox"),this.message=this.options.document.createElement("li"),this.message.textContent=this.options.msgInitial,this.message.className=this.options.messageClass,this.countryToggle=this.options.document.createElement("span"),this.countryToggle.className=this.options.countryToggleClass,this.countryToggle.addEventListener("mousedown",Lr(this)),this.countryIcon=this.options.document.createElement("span"),this.countryIcon.className="idpc_icon",this.countryIcon.innerText=this.currentContext().emoji,this.countryMessage=this.options.document.createElement("span"),this.countryMessage.innerText="Select Country",this.countryMessage.className="idpc_country",this.countryToggle.appendChild(this.countryMessage),this.countryToggle.appendChild(this.countryIcon),this.toolbar=this.options.document.createElement("div"),this.toolbar.className=this.options.toolbarClass,this.toolbar.appendChild(this.countryToggle),this.options.hideToolbar&&Z(this.toolbar),this.list=this.options.document.createElement("ul"),this.list.className=this.options.listClass,this.list.id=this.ids(),this.list.setAttribute("aria-label",this.options.msgList),this.list.setAttribute("role","listbox"),this.mainComponent=this.options.document.createElement("div"),this.mainComponent.appendChild(this.list),this.mainComponent.appendChild(this.toolbar),this.mainComponent.className=this.options.mainClass,Z(this.mainComponent),this.unhideEvent=this.unhideFields.bind(this),this.unhide=this.createUnhide();let n;if(F(this.options.inputField)?n=this.scope.querySelector(this.options.inputField):n=this.options.inputField,!n)throw new Error("Address Finder: Unable to find valid input field");this.input=n,this.input.setAttribute("autocomplete",this.options.autocomplete),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-controls",this.list.id),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-activedescendant",""),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("spellcheck","false"),this.input.id||(this.input.id=this.ids());const i=this.scope.querySelector(this.options.outputFields.country);this.countryInput=i,this.ariaAnchor().setAttribute("role","combobox"),this.ariaAnchor().setAttribute("aria-expanded","false"),this.ariaAnchor().setAttribute("aria-owns",this.list.id),this.placeholderCache=this.input.placeholder,this.inputListener=Ar(this),this.blurListener=Sr(this),this.focusListener=Tr(this),this.keydownListener=Ir(this),this.countryListener=$r(this);const{container:r,announce:s}=Kn({idA:this.ids(),idB:this.ids(),document:this.options.document});this.announce=s,this.alerts=r,this.inputStyle=D(this.input,this.options.inputStyle),D(this.container,this.options.containerStyle),D(this.list,this.options.listStyle);const o=Er(this);D(this.mainComponent,{...o,...this.options.mainStyle}),this.fsm=_r({c:this}),this.init()}setPlaceholder(e){this.input.placeholder=e}unsetPlaceholder(){if(this.placeholderCache===void 0)return this.input.removeAttribute("placeholder");this.input.placeholder=this.placeholderCache}currentContext(){const e=this.options.contexts[this.context];if(e)return e;const n=Object.keys(this.options.contexts)[0];return this.options.contexts[n]}load(){this.attach(),xr(this),this.options.fixed&&Or(this.mainComponent,this.container,this.document),this.options.onLoaded.call(this)}init(){return new Promise(e=>{if(!this.options.checkKey){this.load(),e();return}pe({client:this.client,api_key:this.options.apiKey}).then(n=>{if(!n.available)throw new Error("Key currently not usable");this.updateContexts(te(n.contexts));const i=this.options.contexts[n.context];this.options.detectCountry&&i?this.applyContext(i,!1):this.applyContext(this.currentContext(),!1),this.load(),e()}).catch(n=>{this.options.onFailedCheck.call(this,n),e()})})}updateContexts(e){this.contextSuggestions=qn(e,this.options.restrictCountries),this.options.contexts=e}filteredContexts(){const e=this.query();if(e.trim().length===0)return this.contextSuggestions;const n=e.toLowerCase().trim().replace(/\s+/g," "),i=new RegExp("^"+n);return this.contextSuggestions.filter(r=>!!(i.test(r.description.toLowerCase())||r.iso_2.toLowerCase()===n||r.iso_3.toLowerCase()===n))}renderContexts(){this.list.innerHTML="",this.filteredContexts().forEach((e,n)=>{const{description:i}=e,r=this.options.document.createElement("li");r.textContent=i,r.setAttribute("aria-selected","false"),r.setAttribute("tabindex","-1"),r.setAttribute("aria-posinset",`${n+1}`),r.setAttribute("aria-setsize",this.contextSuggestions.length.toString()),r.setAttribute("role","option"),D(r,this.options.liStyle),r.addEventListener("mousedown",s=>{s.preventDefault(),this.options.onMouseDown.call(this,s),this.fsm.send({type:"SELECT_COUNTRY",contextDetails:e})}),r.id=`${this.list.id}_${n}`,this.list.appendChild(r)}),this.announce(`${this.contextSuggestions.length} countries available`)}renderSuggestions(){this.list.innerHTML="";const e=this.suggestions;e.forEach((n,i)=>{const r=this.options.document.createElement("li");r.textContent=n.suggestion,r.setAttribute("aria-selected","false"),r.setAttribute("tabindex","-1"),r.setAttribute("title",n.suggestion),r.setAttribute("aria-posinset",`${i+1}`),r.setAttribute("aria-setsize",e.length.toString()),r.setAttribute("role","option"),D(r,this.options.liStyle),r.addEventListener("mousedown",s=>{s.preventDefault(),this.options.onMouseDown.call(this,s),this.fsm.send({type:"SELECT_ADDRESS",suggestion:n})}),r.id=`${this.list.id}_${i}`,this.list.appendChild(r)}),this.announce(`${e.length} addresses available`)}goToCurrent(){const e=this.list.children;this.input.setAttribute("aria-activedescendant","");for(let n=0;n<e.length;n+=1)n===this.current?(this.input.setAttribute("aria-activedescendant",e[n].id),e[n].setAttribute("aria-selected","true"),this.goto(n)):e[n].setAttribute("aria-selected","false")}ariaExpand(){this.ariaAnchor().setAttribute("aria-expanded","true")}ariaContract(){this.ariaAnchor().setAttribute("aria-expanded","false")}applySuggestion(e){return this.options.onSelect.call(this,e),this.options.onAddressSelected.call(this,e),this.announce(`The address ${e.suggestion} has been applied to this form`),this.cache.resolve(e,this.options.format).then(n=>{if(n===null)throw"Unable to retrieve address";return this.options.onAddressRetrieved.call(this,n),this.populateAddress(n),this}).catch(n=>(this.open(),this.setMessage(this.options.msgFallback),this.options.onSearchError.call(this,n),n))}populateAddress(e){this.unhideFields(),pr({address:e,config:{...this.options,scope:this.outputScope},outputFields:this.options.outputFields,names:this.options.names,labels:this.options.labels}),this.options.onAddressPopulated.call(this,e)}setQueryOptions(e){this.cache.clear(),this.options.queryOptions=e}attach(){if(this.fsm.status===P.Running)return this;this.input.addEventListener("input",this.inputListener),this.input.addEventListener("blur",this.blurListener),this.input.addEventListener("focus",this.focusListener),this.input.addEventListener("keydown",this.keydownListener),this.input.addEventListener("keydown",this.keydownListener),this.countryInput&&this.countryInput.addEventListener("change",this.countryListener);const e=this.input.parentNode;return e&&(e.insertBefore(this.container,this.input),this.container.appendChild(this.input),this.container.appendChild(this.mainComponent),this.container.appendChild(this.alerts),this.options.hide.length>0&&this.options.unhide==null&&this.container.appendChild(this.unhide)),this.fsm.start(),this.options.onMounted.call(this),this.hideFields(),this}detach(){if(this.fsm.status!==P.Running)return this;this.input.removeEventListener("input",this.inputListener),this.input.removeEventListener("blur",this.blurListener),this.input.removeEventListener("focus",this.focusListener),this.input.removeEventListener("keydown",this.keydownListener),this.countryInput&&this.countryInput.removeEventListener("change",this.countryListener),this.container.removeChild(this.mainComponent),this.container.removeChild(this.alerts);const e=this.container.parentNode;return e&&(e.insertBefore(this.input,this.container),e.removeChild(this.container)),this.unmountUnhide(),this.unhideFields(),this.fsm.stop(),Ni(this.input,this.inputStyle),this.options.onRemove.call(this),this.unsetPlaceholder(),this}setMessage(e){return this.fsm.send({type:"NOTIFY",notification:e}),this}ariaAnchor(){return this.options.aria==="1.0"?this.input:this.container}query(){return this.input.value}clearInput(){k(this.input,"")}setSuggestions(e,n){return n!==this.query()?this:e.length===0?this.setMessage(this.options.msgNoMatch):(this.fsm.send({type:"SUGGEST",suggestions:e}),this)}close(e="blur"){Z(this.mainComponent),e==="esc"&&k(this.input,""),this.options.onClose.call(this,e)}updateSuggestions(e){this.suggestions=e,this.current=-1}applyContext(e,n=!0){const i=e.iso_3;this.context=i,this.cache.clear(),this.countryIcon.innerText=e.emoji,n&&this.announce(`Country switched to ${e.description}`),this.options.onContextChange.call(this,i)}renderNotice(){this.list.innerHTML="",this.input.setAttribute("aria-activedescendant",""),this.message.textContent=this.notification,this.announce(this.notification),this.list.appendChild(this.message)}open(){Ut(this.mainComponent),this.options.onOpen.call(this)}next(){return this.current+1>this.list.children.length-1?this.current=0:this.current+=1,this}previous(){return this.current-1<0?this.current=this.list.children.length-1:this.current+=-1,this}scrollToView(e){const n=e.offsetTop,i=this.list.scrollTop;n<i&&(this.list.scrollTop=n);const r=this.list.clientHeight,s=e.clientHeight;return n+s>i+r&&(this.list.scrollTop=n-r+s),this}goto(e){const n=this.list.children,i=n[e];return e>-1&&n.length>0?this.scrollToView(i):this.scrollToView(n[0]),this}opened(){return!this.closed()}closed(){return this.fsm.state.matches("closed")}createUnhide(){const e=Ht(this.scope,this.options.unhide,()=>{const n=this.options.document.createElement("p");return n.innerText=this.options.msgUnhide,n.setAttribute("role","button"),n.setAttribute("tabindex","0"),this.options.unhideClass&&(n.className=this.options.unhideClass),n});return e.addEventListener("click",this.unhideEvent),e}unmountUnhide(){this.unhide.removeEventListener("click",this.unhideEvent),this.options.unhide==null&&this.options.hide.length&&Pi(this.unhide)}hiddenFields(){return this.options.hide.map(e=>F(e)?Oi(this.options.scope,e):e).filter(e=>e!==null)}hideFields(){this.hiddenFields().forEach(Z)}unhideFields(){this.hiddenFields().forEach(Ut),this.options.onUnhide.call(this)}}const Sr=t=>function(){t.options.onBlur.call(t),t.fsm.send({type:"CLOSE",reason:"blur"})},Tr=t=>function(e){t.options.onFocus.call(t),t.fsm.send("AWAKE")},Ar=t=>function(e){if(t.query().toLowerCase()===":c")return k(t.input,""),t.fsm.send({type:"CHANGE_COUNTRY"});t.fsm.send({type:"INPUT",event:e})},Lr=t=>function(e){e.preventDefault(),t.fsm.send({type:"CHANGE_COUNTRY"})},Ir=t=>function(e){const n=br(e);if(n==="Enter"&&e.preventDefault(),t.options.onKeyDown.call(t,e),t.closed())return t.fsm.send("AWAKE");if(t.fsm.state.matches("suggesting_country")){if(n==="Enter"){const i=t.filteredContexts()[t.current];i&&t.fsm.send({type:"SELECT_COUNTRY",contextDetails:i})}n==="Backspace"&&t.fsm.send({type:"INPUT",event:e}),n==="ArrowUp"&&(e.preventDefault(),t.fsm.send("PREVIOUS")),n==="ArrowDown"&&(e.preventDefault(),t.fsm.send("NEXT"))}if(t.fsm.state.matches("suggesting")){if(n==="Enter"){const i=t.suggestions[t.current];i&&t.fsm.send({type:"SELECT_ADDRESS",suggestion:i})}n==="Backspace"&&t.fsm.send({type:"INPUT",event:e}),n==="ArrowUp"&&(e.preventDefault(),t.fsm.send("PREVIOUS")),n==="ArrowDown"&&(e.preventDefault(),t.fsm.send("NEXT"))}n==="Escape"&&t.fsm.send({type:"CLOSE",reason:"esc"}),n==="Home"&&t.fsm.send({type:"RESET"}),n==="End"&&t.fsm.send({type:"RESET"})},$r=t=>function(e){if(e.target===null)return;const n=e.target;if(!n)return;let i=kr(n.value,t.options.contexts);t.fsm.send({type:"COUNTRY_CHANGE_EVENT",contextDetails:i})},Ht=(t,e,n)=>F(e)?t.querySelector(e):n&&e===null?n():e,Or=(t,e,n)=>{const i=(s,o)=>{if(s===null)return;const a=s.getBoundingClientRect();o.style.minWidth=`${Math.round(a.width)}px`},r=e.parentElement;t.style.position="fixed",t.style.left="auto",i(r,t),n.defaultView!==null&&n.defaultView.addEventListener("resize",()=>{i(r,t)})},kr=(t,e)=>{const n=t.toUpperCase();for(const i of Object.values(e))if(i.iso_3===n||i.iso_2===n||i.description.toUpperCase()===n)return i},xt=t=>{const e=new _e(t);return Se.push(e),e},Nr=(t,e)=>new Promise((n,i)=>{(e||document).addEventListener("DOMContentLoaded",r=>{const s=xt(t);return n(s)})}).catch(n=>null),Se=[],Pr=()=>!0,Ur=(t,e)=>{const i=ge(t.scope||null).querySelectorAll(t.anchor||t.inputField||(t.outputFields||{}).line_1);return Ti(i).filter(r=>!Ai(r,e))},Rr=1e3,jr=t=>$i(t,"FORM"),Fr=(t,e={})=>{const n=new fe({api_key:t.apiKey}),{pageTest:i=Pr}=e;return i()?pe({client:n}).then(r=>{if(!r.available)return null;const{getScope:s=jr,interval:o=Rr,anchor:a,onBind:l=f,onAnchorFound:u=f,onBindAttempt:d=f,immediate:h=!0,marker:b="idpc"}=e,v=()=>{d({config:t,options:e}),Ur({anchor:a,...t},b).forEach(E=>{const g=s(E);if(!g)return;const T=te(r.contexts),C={scope:g,...t,checkKey:!1,contexts:T};u({anchor:E,scope:g,config:C});const m=xt(C),w=m.options.contexts[r.context];m.options.detectCountry&&w?m.applyContext(w,!1):m.applyContext(m.currentContext(),!1),Li(E,b),l(m)})},{start:x,stop:_}=Ri({bind:v,pageTest:i,interval:o});return h&&x(),{start:x,stop:_,bind:v}}).catch(r=>(e.onError&&e.onError(r),null)):Promise.resolve(null)},Mr={setup:xt,controllers:Se,Controller:_e,defaults:ht,watch:Fr,go:Nr},Dr=Re(),L=window._K||{str:{},route:{}},c={addingMarkers:!1,buttons:{},markers:[],hasLoc:!!S.urlParam("lat"),center:{lat:Number(S.urlParam("lat")||53.2764),lng:Number(S.urlParam("lng")||-3.22189)},hasZoom:!!S.urlParam("zoom"),zoom:Number(S.urlParam("zoom")||14)};(async()=>{const t=await Kt("/google"),e=new R({apiKey:t.api,version:"weekly"});c.core=await e.importLibrary("core"),c.maps=await e.importLibrary("maps"),c.marker=await e.importLibrary("marker"),c.places=await e.importLibrary("places"),c.infos=await Kt("/info"),c.map=new c.maps.Map(document.getElementById("map"),{center:c.center,zoom:c.zoom,mapId:t.id,mapTypeId:c.maps.MapTypeId.ROADMAP,streetViewControl:!1,mapTypeControl:!1}),c.infoWindow=new c.maps.InfoWindow;const n=$("<div />",{class:"flex flex-col justify-center items-center rounded-sm shadow-[#0000004d_0px_1px_4px_-1px] bg-white mr-2.5"});c.buttons.add=Wt("fa-regular fa-location-plus text-xl border-b","Add marker!"),c.buttons.pos=Wt("fa-regular fa-circle-dot text-base","Geolocation!"),n.append(c.buttons.add),n.append(c.buttons.pos),c.map.controls[c.core.ControlPosition.RIGHT_TOP].push(n[0]),c.map.addListener("click",r=>{c.addingMarkers&&($("#infoBtn").trigger("click"),$("#lat").val(r.latLng.lat().toFixed(5)),$("#lng").val(r.latLng.lng().toFixed(5)),zt(r.latLng))}),c.core.event.addListener(c.map,"zoom_changed",Bt),c.core.event.addListener(c.map,"dragend",function(){S.addURLParam("lat",c.map.center.lat().toFixed(5)),S.addURLParam("lng",c.map.center.lng().toFixed(5))}),c.infos.forEach(r=>{zt(new c.core.LatLng(r.position.lat,r.position.lng),r,!1)}),c.buttons.add.on("click",Te),c.buttons.pos.on("click",qt),!c.hasLoc&&qt(),Bt();const i=new c.marker.AdvancedMarkerElement({map:c.map,content:$("<i />",{class:"fa-duotone fa-circle-dot text-blue-500 text-lg"})[0]});zr({onSuccess:({coords:{latitude:r,longitude:s}})=>i.position=new c.core.LatLng(r,s)}),Hr()})();function Gr(t){return S.type(t.lat)=="number"&&(t=new c.core.LatLng(t.lat,t.lng)),{google:`https://www.google.com/maps/search/?api=1&query=${t.lat()},${t.lng()}`,apple:`https://maps.apple.com/?ll=${t.lat()},${t.lng()}&z=10&q=result`,waze:`https://www.waze.com/ul/?ll=${t.lat()},${t.lng()}&z=10`}}function Hr(){const t=$("#map-search"),e=$("#search-card"),n=new c.marker.AdvancedMarkerElement;Ae(n),c.map.controls[c.core.ControlPosition.TOP_LEFT].push(e[0]),Mr.setup({apiKey:"ak_luen9mkza3ZJx0FpImxZ0BKxKqOMe",inputField:"#map-search",onAddressRetrieved:i=>{n.map=null,console.log(i);const r=new c.core.LatLng(i.latitude,i.longitude),s=[i.line_1||"",i.line_2||"",i.line_3||"",i.post_town,i.postcode];let o="";s.forEach(a=>{o+=`${a?`${o?", ":""}${a}`:""}`}),t.val(o),c.map.setCenter(r),c.map.setZoom(17),n.content=Br(r,o),n.position=r,n.map=c.map,n.address=o},containerClass:"relative",mainClass:"absolute shadow-sm z-50 mt-2 w-full rounded-md border border-gray-300 bg-white overflow-hidden",listClass:"max-h-40 overflow-y-auto [&>li]:cursor-pointer [&>li:not(:last-child)]:border-b [&>li]:border-gray-300 [&>li]:px-4 [&>li]:py-1 [&>li]:text-base hover:[&>li]:bg-gray-100",messageClass:"!cursor-default italic hover:!bg-transparent",toolbarClass:"flex items-center justify-end border-t border-gray-300 bg-gray-100 px-3 py-1",countryToggleClass:"hover-first flex cursor-pointer items-center gap-2 whitespace-nowrap text-sm [&>*:first-child]:block [&>*:first-child]:overflow-hidden [&>*:first-child]:transition-all [&>*:last-child]:bg-gray-100 [&>*:last-child]:text-base [&>*:last-child]:font-bold [&>*]:align-baseline"})}async function Kt(t){return await(await fetch(t)).json()}function Bt(){const t=c.map.getZoom().toFixed(2);S.addURLParam("zoom",t),S.each(c.markers,(e,n)=>n.map=t>=16?c.map:null)}function Te(){c.addingMarkers?(c.map.setOptions({draggableCursor:""}),c.buttons.add.removeClass("text-blue-500").addClass("text-blue-700"),c.addingMarkers=!1):(c.map.setOptions({draggableCursor:`url(${$("#markerSrc").attr("src")}), auto`}),c.buttons.add.addClass("text-blue-500").removeClass("text-blue-700"),c.addingMarkers=!0)}function qt(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const e=new c.core.LatLng(t.coords.latitude,t.coords.longitude);c.map.setCenter(e),c.map.setZoom(17)},()=>{Yt(!0,c.infoWindow.getPosition())}):Yt(!1,c.map.getCenter())}function zt(t,e=null,n=!0){const i=new c.marker.AdvancedMarkerElement({position:t,map:c.map,content:qr(e)});i.data=e,Ae(i),c.markers.push(i),n&&(Te(),c.map.panTo(t))}function Kr(t){t.content.classList.contains("highlight")?(t.content.classList.remove("highlight"),t.zIndex=null):(t.content.classList.add("highlight"),t.zIndex=1)}function Ae(t){t.addListener("click",e=>{const n=$(e.domEvent.srcElement),i=t.data||null;let r={};if(!n.hasClass("link")){if(n.hasClass("edit")){r={"title.text":L.str.editLocation,"form.action":L.route.infoUpdate,"method.value":"PATCH","id.value":i.id,"lat.value":i.position.lat,"lng.value":i.position.lng,"address.value":i.address,"note.value":i.note,"destroy.removeclass":"hidden","destroy.data":{modal:{"id.value":i.id}},"submit.text":L.str.save},S.isIn(i.creator,[L.str.username,"Kraig Larner"])||(r["destroy.addclass"]="hidden",r["destroy.data"]={modal:{"id.value":""}},delete r["destroy.removeclass"]),$("#editBtn").data("modal",r).trigger("click");return}if(n.hasClass("move")&&(t.gmpDraggable?(t.content.classList.remove("moving"),t.gmpDraggable=!1):(t.content.classList.add("moving"),t.gmpDraggable=!0)),n.hasClass("save")){r={"title.text":L.str.addLocation,"form.action":L.route.infoAdd,"method.value":"PUT","id.value":"","lat.value":t.position.lat,"lng.value":t.position.lng,"address.value":t.address,"note.value":"","destroy.addclass":"hidden","submit.text":L.str.add},$("#infoBtn").data("modal",r).trigger("click");return}if(n.hasClass("changes")){$(".changesBtn").data("modal",{"tbody.changes":i.changes}).trigger("click");return}Kr(t)}}),t.addListener("dragend",e=>{const n=t.data||null;n&&t.content.classList.contains("moving")&&Dr.run(()=>{$.ajax({url:L.route.infoLocation,method:"POST",data:{id:n.id,lat:e.latLng.lat().toFixed(5),lng:e.latLng.lng().toFixed(5),_token:$('[name="_token"]').first().val()}}).done(function(i){})},2e3)})}function Br(t,e){const n=$("<div />",{class:"marker font-sans"});n.append($("<div />",{class:"icon",html:$("<i />",{class:"fa-solid fa-location-crosshairs"})}));const i=$("<div />",{class:"details"}).appendTo(n);$("<div />",{class:"title",text:L.str.mapLinks}).appendTo(i),$("<div />",{class:"address",html:Le(e)}).appendTo(i);const r=$("<div />",{class:"links btns flex justify-between items-center text-3xl gap-3"}).appendTo(i),s=Gr(t);return S.each(s,(o,a)=>{$("<a />",{href:a,target:"_blank",html:`<i class="link fa-brands fa-${o} cursor-pointer"></i>`}).appendTo(r)}),$("<i />",{class:"save fa-regular fa-floppy-disk cursor-pointer text-orange-400 text-lg self-end"}).appendTo(r),n[0]}function Le(t){if(t.length<=30)return t;let e=Math.floor(t.length/2);const n=t.lastIndexOf(" ",e),i=t.indexOf(" ",e+1);return n==-1||i!=-1&&e-n>=i-e?e=i:e=n,`${t.substr(0,e)}<br>${t.substr(e+1)}`}function qr(t=null){const e=$("<div />",{class:"marker font-sans",data:t});let n=$("<i />");if(t&&t.note&&t.note.bMatch(/\b\d{4}\b/)?n.addClass("fa-solid fa-user"):n.addClass("fa-solid fa-note"),e.append($("<div />",{class:"icon",html:n})),t){const i=$("<div />",{class:"details"}).appendTo(e);$("<div />",{class:"title",text:L.str.locationInformation}).appendTo(i),t.address&&$("<div />",{class:"address",html:Le(t.address)}).appendTo(i),t.note&&$("<div />",{class:"note whitespace-pre-wrap",text:t.note}).appendTo(i);const r=$("<div />",{class:"footer"}).appendTo(i),s=$("<div />",{class:"btns text-lg sm:text-sm flex gap-4 sm:gap-2"}).appendTo(r);$("<i />",{class:"edit fa-regular fa-edit cursor-pointer text-amber-500"}).appendTo(s),$("<i />",{class:"move fa-regular fa-arrows-up-down-left-right cursor-pointer text-emerald-500"}).appendTo(s),t.changes.length&&$("<i />",{class:"changes far fa-rotate cursor-pointer text-sky-500"}).appendTo(s),$("<div />",{class:"creator",text:t.creator}).appendTo(r)}return e[0]}function Wt(t,e){return $("<button />",{class:t+" text-center text-gray-500 hover:text-gray-700 w-10 h-10 transition",title:e,type:"button"})}function Yt(t,e){c.infoWindow.setPosition(e),c.infoWindow.setContent(t?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),c.infoWindow.open(c.map)}function zr({onSuccess:t,onError:e=()=>{}}){return"geolocation"in navigator?navigator.geolocation.watchPosition(t,e):e(new Error("Geolocation is not supported by this browser."))}
